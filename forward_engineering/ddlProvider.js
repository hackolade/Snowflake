"use strict";var rn=Object.defineProperty;var n=(r,i)=>rn(r,"name",{value:i,configurable:!0});var W=(r,i)=>()=>(i||r((i={exports:{}}).exports,i),i.exports);var je=W((er,Je)=>{"use strict";Je.exports={number:"NUMBER",string:"VARCHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BOOLEAN",document:"OBJECT",array:"ARRAY",objectId:"VARCHAR(24)",default:"CHAR"}});var et=W((tr,ke)=>{"use strict";ke.exports={NUMBER:{capacity:12,mode:"decimal"},DECIMAL:{capacity:12,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},BYTEINT:{capacity:1},TINYINT:{capacity:1},SMALLINT:{capacity:2},REAL:{capacity:4,mode:"floating"},FLOAT:{capacity:8,mode:"floating"},FLOAT4:{capacity:4,mode:"floating"},FLOAT8:{capacity:8,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},VARCHAR:{mode:"varying"},CHAR:{size:1},CHARACTER:{size:1},STRING:{mode:"varying"},TEXT:{mode:"text"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:8e3,mode:"binary"},BOOLEAN:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss.nn"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP_LTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMPLTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMP_NTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMPNTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},"TIMESTAMP WITHOUT TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMP_TZ:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMPTZ:{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH LOCAL TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},VARIANT:{format:"semi-structured"},OBJECT:{format:"semi-structured",mode:"object"},ARRAY:{format:"semi-structured",mode:"array"},GEOGRAPHY:{mode:"geography"}}});var Ye=W((nr,tt)=>{"use strict";tt.exports={createDatabase:"CREATE DATABASE IF NOT EXISTS ${name};\nUSE DATABASE ${name};\n",createSchema:"CREATE${transient} SCHEMA IF NOT EXISTS ${name}${managed_access}${data_retention}${comment};\nUSE SCHEMA ${name};\n",dropSchema:"DROP SCHEMA IF EXISTS ${name};\n",createTable:"CREATE${temporary}${transient} TABLE IF NOT EXISTS\n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",createDynamicTable:"CREATE${orReplace}${transient} DYNAMIC${iceberg} TABLE${tableIfNotExists}\n	${name}\n${column_definitions}${targetLag}${warehouse}${externalVolume}${catalog}${baseLocation}${refreshMode}${initialize}${clusterKeys}${dataRetentionTime}${maxDataExtensionTime}${copyGrants}${comment}${tagsStatement}${selectStatement};\n",createLikeTable:"CREATE TABLE IF NOT EXISTS ${name} LIKE ${source_table}${tableOptions};\n",createCloneTable:"CREATE TABLE IF NOT EXISTS ${name} CLONE ${source_table}${tableOptions};\n",createAsSelect:"CREATE TABLE IF NOT EXISTS ${name} AS ${selectStatement}${tableOptions};\n",createExternalTable:"CREATE EXTERNAL TABLE IF NOT EXISTS \n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",columnDefinition:"${name} ${type}${collation}${default}${identity}${autoincrement}${not_nul}${inline_constraint}${comment}${tag}",externalColumnDefinition:"${name} ${type} as ${expression}${comment}",createTableForeignKey:"${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns})",alterTableForeignKey:"ALTER TABLE IF EXISTS ${table_name} ADD ${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns});",createView:"CREATE${secure}${materialized} VIEW IF NOT EXISTS ${name} (\n	${column_list}\n)\n${copy_grants}${comment}${tag}${clustering}AS ${select_statement};\n",createUDF:"CREATE${orReplace} FUNCTION ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createSequence:"CREATE SEQUENCE IF NOT EXISTS ${name} START ${start} INCREMENT ${increment}${comment};\n",createFileFormat:"CREATE FILE FORMAT IF NOT EXISTS ${name}${options}${comment};\n",createStage:"CREATE${temporary} STAGE IF NOT EXISTS ${name} ${url}${storageIntegration}${credentials}${encryption};\n",alterSchema:"ALTER SCHEMA IF EXISTS ${name} ${operation} ${options};",alterTable:"ALTER${dynamic} TABLE IF EXISTS ${name} ${action};",alterView:"ALTER${materialized} VIEW IF EXISTS ${name} ${action};",alterSchemaScript:"ALTER SCHEMA IF EXISTS ${name} ",alterTableScript:"ALTER${dynamic} TABLE IF EXISTS ${name} ",alterEntityRename:"RENAME TO ${name};\n",setPropertySchema:"SET ${property};\n",unsetPropertySchema:"UNSET ${property};\n",manageAccessSchema:"${access} MANAGED ACCESS;\n",setPropertyTable:"SET ${property};\n",alterViewScript:"ALTER VIEW IF EXISTS ${name} ",alterMaterializedViewScript:"ALTER MATERIALIZED VIEW ${name} ",createTag:"CREATE${orReplace} TAG${ifNotExist} ${name}${allowedValues}${comment};\n",dropTag:"DROP TAG IF EXISTS ${name};\n",alterTag:"ALTER TAG${ifExists} ${name} ${option}${optionValue};\n"}});var be=W((rr,nt)=>{"use strict";var sn=["DROP SCHEMA","DROP TABLE","DROP COLUMN","DROP VIEW","DROP TAG"],an={JAVA:"java",JAVASCRIPT:"javascript",PYTHON:"python",SCALA:"scala",SQL:"sql"},on={SNOWSIGHT:"snowSight",CLASSIC_UI:"classicUI"};nt.exports={DROP_STATEMENTS:sn,LANGUAGES:an,FORMATS:on}});var it=W((sr,st)=>{"use strict";var mn=require("lodash"),rt={ON_ERROR:"ABORT_STATEMENT",SIZE_LIMIT:null,PURGE:!0,RETURN_FAILED_ONLY:!1,MATCH_BY_COLUMN_NAME:"none",ENFORCE_LENGTH:!0,TRUNCATECOLUMNS:!1,FORCE:!1},cn=n((r={},i={},t=[])=>t.reduce((a,E)=>mn.isEqual(r[E],i[E])?a:!i[E]&&r[E]!==rt[E]?{...a,[E]:rt[E]}:i[E]?{...a,[E]:i[E]}:a,{}),"getDiffCopyOptionsByDefault");st.exports={getDiffCopyOptionsByDefault:cn}});var Et=W((ar,Tt)=>{"use strict";var ve=require("lodash"),{getDiffCopyOptionsByDefault:Tn}=it(),at=["description","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS"],ot=["targetLag","warehouse","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS","description"],En=ve.uniq([...at,...ot]),un=["id"],ln=n((r,i)=>i.some(t=>(r==null?void 0:r.oldField[t])!==(r==null?void 0:r.newField[t])),"checkFieldPropertiesChanged"),An=n(r=>({udfs:r.UDFs,sequences:r.sequences,fileFormats:r.fileFormats}),"prepareContainerLevelData"),pn=n((r,i,t)=>{let{schemaName:a,databaseName:E}=mt(r,i),u=i(r.isCaseSensitive,t(r));return{schemaName:a,databaseName:E,tableName:u}},"getNames"),mt=n((r,i)=>{var l;let{database:t,isCaseSensitive:a}=((l=r.compMod)==null?void 0:l.bucketProperties)||{},{keyspaceName:E}=r.compMod,u=i(a,E),R=i(a,t);return{schemaName:u,databaseName:R}},"getBaseAndContainerNames"),Nn=n(({collection:r,data:i})=>{let{database:t}=(r==null?void 0:r.role)||{};return i={...i,nameData:{...i.nameData||{},database:t}},{collection:r,data:i}},"prepareContainerName"),Sn=n(({collection:r,data:i})=>{var a,E,u;let t=((a=r==null?void 0:r.role)==null?void 0:a.compMod)||{};return i={...i,nameData:{...i.nameData||{},isExternal:(E=r==null?void 0:r.role)==null?void 0:E.external,database:(u=t==null?void 0:t.bucketProperties)==null?void 0:u.database,schemaName:t==null?void 0:t.keyspaceName}},{collection:r,data:i}},"prepareTableName"),yn=n((r={})=>{let i=r.code,t=r.name||r.collectionName;return{oldName:(i==null?void 0:i.old)||(t==null?void 0:t.old),newName:(i==null?void 0:i.new)||(t==null?void 0:t.new)}},"setName"),dn=n(({collection:r,data:i})=>{let{compMod:t,isCaseSensitive:a,name:E,code:u,materialized:R}=(r==null?void 0:r.role)||{},l=yn(t),G=(l==null?void 0:l.newName)!==(l==null?void 0:l.oldName);return i={...i,nameData:{...i.nameData||{},isCaseSensitive:a,nameIsChanged:G,isMaterialized:R,newName:(l==null?void 0:l.newName)||u||E,oldName:l==null?void 0:l.oldName}},{collection:r,data:i}},"prepareName"),gn=n(({collection:r,data:i})=>{let{compMod:t}=(r==null?void 0:r.role)||{},a=En.reduce((E,u)=>{let{new:R,old:l}=(t==null?void 0:t[u])||{};return l!==R?R&&ot.includes(u)?{...E,set:{...E.set,[u]:R}}:l&&at.includes(u)?{...E,unset:[...E.unset,u]}:E:E},{set:{},unset:[]});return{collection:r,data:{...i,setProperty:a.set,unsetProperty:a.unset}}},"prepareAlterSetUnsetData"),In=n(({collection:r,data:i})=>{var E,u;let t=(u=(E=r==null?void 0:r.role)==null?void 0:E.compMod)==null?void 0:u.managedAccess,a=t&&(t==null?void 0:t.new)!==(t==null?void 0:t.old);return{collection:r,data:{...i,managedAccess:{isChange:a,value:!!(t!=null&&t.new)}}}},"prepareMenageContainerData"),Rn=n(({collection:r,data:i})=>{let t=(r==null?void 0:r.role)||{},a=t.compMod||{},{new:E,old:u}=a.fileFormat||{},{new:R,old:l}=a.customFileFormatName||{};return{collection:r,data:{...i,formatData:{isChangeCustomFileFormat:(R||l)&&R!==l,isChangeType:(E||u)&&E!==u,fileFormat:E||(t==null?void 0:t.fileFormat),formatName:R}}}},"prepareCollectionFileFormat"),ct=n((r={},i={})=>{let t=Object.keys(r),a=Object.keys(i);return ve.union(t,a).filter(E=>!un.includes(E))},"getObjectCommonKeys"),Cn=n(({collection:r,data:i})=>{var R,l;let{new:t={},old:a={}}=((l=(R=r==null?void 0:r.role)==null?void 0:R.compMod)==null?void 0:l.formatTypeOptions)||{},u=ct(a,t).some(G=>!ve.isEqual(t[G],a[G]));return{collection:r,data:{...i,formatTypeOptions:{optionsIsChanged:u,typeOptions:t}}}},"prepareCollectionFormatTypeOptions"),On=n((r,i,t)=>({collection:a,data:E})=>{var A,f;let{new:u={},old:R={}}=((f=(A=a==null?void 0:a.role)==null?void 0:A.compMod)==null?void 0:f.stageCopyOptions)||{},l=ct(R,u),G=l.some(h=>!t.isEqual(u[h],R[h])),x=Tn(R,u,l);x={...x,sizeLimit:t.has(x,"SIZE_LIMIT")};let b={optionsIsChanged:G,options:r(i(x))};return{collection:a,data:{...E,stageCopyOptions:b}}},"prepareCollectionStageCopyOptions");Tt.exports={checkFieldPropertiesChanged:ln,prepareContainerLevelData:An,getBaseAndContainerNames:mt,getNames:pn,prepareTableName:Sn,prepareContainerName:Nn,prepareName:dn,prepareAlterSetUnsetData:gn,prepareMenageContainerData:In,prepareCollectionFileFormat:Rn,prepareCollectionFormatTypeOptions:Cn,prepareCollectionStageCopyOptions:On}});var Ne=W((mr,ut)=>{"use strict";var{FORMATS:_n}=be(),fn=/(\\r|\\n|\\b|\\f|\\t|'|"|\\[0-9]{3}|\0|\\x5C[0-3]?[0-7]{1,2}|\x5C[xX][0-9A-Fa-f]{2}|\x5C[uU][0-9A-Fa-f]{4}|\\)/g,$n=n((r,i)=>r===_n.SNOWSIGHT?`'${i.replace(fn,"\\$1")}'`:`$$${i}$$`,"escapeString");ut.exports={escapeString:$n}});var At=W((Tr,lt)=>{"use strict";var Mn=n(({index:r,numberOfStatements:i,lastIndexOfActivatedStatement:t,delimiter:a})=>{let E=r===i-1,u=r===t;return E?"":u?" //"+a:a},"getDelimiter"),Ln=n(({statements:r=[],delimiter:i=",",indent:t=`
`})=>{let a=r.findLastIndex(u=>!u.startsWith("//")),E=r.length;return r.map((u,R)=>{let l=Mn({index:R,numberOfStatements:E,lastIndexOfActivatedStatement:a,delimiter:i});return u+l}).join(t)},"joinActivatedAndDeactivatedStatements");lt.exports={joinActivatedAndDeactivatedStatements:Ln}});var St=W((ur,Nt)=>{"use strict";var pt=n((r="")=>new RegExp("\\$\\{(.*?)}",r),"template"),Pn=n(r=>r.match(pt("gi"))||[],"getAllTemplates"),Fn=n(r=>(r.match(pt("i"))||[])[1],"parseTemplate"),Kn=n((r,i)=>Pn(r).reduce((t,a)=>{let E=Fn(a);return t.replace(a,()=>i[E]||i[E]===0?i[E]:"")},r),"assignTemplates");Nt.exports=Kn});var Be=W((Ar,yt)=>{"use strict";var Un=require("lodash"),hn=["//"],Yn=n((r,i,t)=>Un.has(i,"isActivated")&&!i.isActivated?t?"// "+r:r.includes(`
`)?r.split(`
`).filter(Boolean).map(a=>"// "+a).join(`
`).concat(`
`):r?"// "+r:"":r,"commentIfDeactivated"),bn=n((r="")=>hn.some(i=>r.startsWith(i)),"queryIsDeactivated");yt.exports={commentIfDeactivated:Yn,queryIsDeactivated:bn}});var ae=W((Nr,dt)=>{"use strict";var Z=require("lodash"),vn=St(),{commentIfDeactivated:Se}=Be();dt.exports=r=>{let{checkAllKeysActivated:i}=r.require("@hackolade/ddl-fe-utils").general,t=n(s=>String(s).replace(/'/g,"''").replace(/\\\\/g,"\\").replace(/\\/g,"\\\\"),"escape"),a=n(s=>Z.isUndefined(s)?s:`'${t(s)}'`,"toString"),E=n(s=>Z.toLower(s)==="none","isNone"),u=n(s=>Z.toLower(s)==="auto","isAuto"),R=n(s=>E(s)?s:a(s),"toStringIfNotNone"),l=n(s=>u(s)?s:a(s),"toStringIfNotAuto"),G=n(s=>isNaN(s)?"":Number(s),"toNumber"),x=n(s=>s===!0?"TRUE":void 0,"toBoolean"),b=n(s=>Object.entries(s).filter(([N,C])=>!Z.isEmpty(C)||C!==!1).map(([N,C])=>(Array.isArray(C)&&(C="("+C.filter(M=>!Z.isEmpty(M)).join(", ")+")"),`${N}=${C}`)).join(`
`),"toOptions"),A=n((s,N,C)=>{if(N.GUID===s)return[{...N,name:C}];if(Z.isPlainObject(N.properties)){let M=Object.keys(N.properties).reduce((K,D)=>{if(K.length)return K;let w=A(s,N.properties[D],D);return w?K.concat(w):K},[]);if(M.length)return[{...N,name:C}].concat(M)}else if(Z.isArray(N.items)){let M=N.items.reduce((K,D)=>{if(K.length)return K;let w=A(s,D,"");return w?K.concat(w):K},[]);if(M.length)return[{...N,name:C}].concat(M)}else if(N.items){let M=A(s,N.items,"");if(M)return[{...N,name:C}].concat(M)}},"findJsonSchemaChain"),f=n((s,N,C)=>{let M=Z.get(C,"clusteringKey[0].name",""),K=Z.get(C,"clusteringKey[0].isActivated",!0),D=n(w=>String(w||"").includes("."),"isComplexName");if(C.expression)return{name:vn(C.expression,{name:P(s,M)}),isActivated:K,isExpression:!0};if(M&&!D(M))return{name:M,isActivated:K};{let w=Z.get(C,"clusteringKey[0].keyId",""),Q=A(w,N);if(Array.isArray(Q)){let ce=Z.get(Q[Q.length-1],"type","").replace(/json/i,"").toLowerCase();return{name:`(${Q.map(Ee=>P(s,Ee.name)).filter(Boolean).join(":")}::${ce})`,isActivated:K,isExpression:!0}}}},"composeClusteringKey"),h=n((s,N)=>{if(Array.isArray(N)){let C=", ",M=[],K=N.reduce((D,w)=>{let Q=Z.isString(w.name)?w.name.trim():w.trim();return w.isExpression||(Q=P(s,Q)),Z.get(w,"isActivated",!0)?[...D,Q]:(M.push(Q),D)},[]).filter(Boolean);return K.length===0?Se(M.join(C),{isActivated:!1},!0):M.length===0?K.join(C):K.join(C)+Se(C+M.join(C),{isActivated:!1},!0)}return N},"foreignKeysToString"),S=n((s,N)=>N==null?void 0:N.map(C=>P(s,C.name.trim())).join(", "),"foreignActiveKeysToString"),m=n(s=>i(s.foreignKey)&&i(s.primaryKey)&&s.primaryTableActivated&&s.foreignTableActivated,"checkIfForeignKeyActivated"),I=n((s,N)=>{if(!N)return s.map(K=>K.name).join(`,
	`);let C=s.filter(K=>K.isActivated).map(K=>K.name),M=s.filter(K=>!K.isActivated).map(K=>K.name);return C.length===0?Se(M.join(`,
	`),{isActivated:!1},!0):M.length===0?C.join(`,
	`):C.join(`,
	`)+`
	`+Se(M.join(`,
	`),{isActivated:!1},!0)},"viewColumnsToString"),P=n((s,N)=>N&&(s?$(N):y(N)?N:$(N)),"getName"),O=n(s=>s&&(s.code||s.collectionName)||"","getEntityName"),g=n((s,N)=>s?`${s}.${N}`:N,"getFullName"),y=n(s=>/^[a-z_][a-z\d_$]*$/i.test(s),"isValidCaseInsensitiveName"),$=n(s=>/^".*"$/.test(s)?s:`"${s}"`,"addQuotes");return{escape:t,toString:a,isNone:E,isAuto:u,toStringIfNotNone:R,toStringIfNotAuto:l,toNumber:G,toBoolean:x,toOptions:b,composeClusteringKey:f,foreignKeysToString:h,checkIfForeignKeyActivated:m,foreignActiveKeysToString:S,viewColumnsToString:I,getName:P,getEntityName:O,getFullName:g,getDbName:n(s=>Z.get(s,"code")||Z.get(s,"name",""),"getDbName"),addQuotes:$,getGroupItemsByCompMode:n(({newItems:s=[],oldItems:N=[]})=>{let C=s.filter(D=>!N.some(w=>w.id===D.id)),M=[],K=[];return N.forEach(D=>{let w=s.find(Q=>Q.id===D.id);w?Z.isEqual(w,D)||K.push(w):M.push(D)}),{added:C,removed:M,modified:K}},"getGroupItemsByCompMode")}}});var It=W((yr,gt)=>{"use strict";var se=require("lodash");gt.exports=r=>{let{clean:i}=r.require("@hackolade/ddl-fe-utils").general,{addQuotes:t}=ae()(r),a=n((m,I)=>Object.entries(m.properties).map(I),"mapProperties"),E=n(m=>!(m.compositeUniqueKey||!m.unique),"isUniqueKey"),u=n(m=>!(m.compositeUniqueKey||m.compositePrimaryKey||!m.primaryKey),"isPrimaryKey"),R=n((m,I,P,O)=>i({keyType:"UNIQUE",name:m.constraintName,columns:[{name:I,isActivated:P}],include:b(m.include||m.indexInclude||[],O),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydrateUniqueOptions"),l=n((m,I,P,O)=>i({keyType:"PRIMARY KEY",name:m.constraintName,columns:[{name:I,isActivated:P}],include:b(m.include||m.indexInclude||[],O),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydratePrimaryKeyOptions"),G=n((m,I)=>Object.keys(I).find(P=>I[P].GUID===m),"findName"),x=n((m,I)=>se.get(Object.values(I).find(P=>P.GUID===m),"isActivated",!0),"checkIfActivated"),b=n((m,I)=>se.map(m,P=>({name:G(P.keyId,I.properties),isActivated:x(P.keyId,I.properties)})),"getKeys"),A=n(m=>Array.isArray(m.primaryKey)?m.primaryKey.filter(I=>!se.isEmpty(I.compositePrimaryKey)).map(I=>({...l(I,null,null,m),columns:b(I.compositePrimaryKey,m)})):[],"getCompositePrimaryKeys"),f=n(m=>Array.isArray(m.uniqueKey)?m.uniqueKey.filter(I=>!se.isEmpty(I.compositeUniqueKey)).map(I=>({...R(I,null,null,m),columns:b(I.compositeUniqueKey,m)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:n(({jsonSchema:m})=>{if(!m.properties)return[];let I=a(m,([O,g])=>{if(u(g)){if(se.isEmpty(g.primaryKeyOptions))return}else return;return l(se.first(g.primaryKeyOptions),O,g.isActivated,m)}).filter(Boolean),P=se.flatten(a(m,([O,g])=>{if(E(g)){if(se.isEmpty(g.uniqueKeyOptions)||!Array.isArray(g.uniqueKeyOptions))return[]}else return[];return g.uniqueKeyOptions.map(y=>R(y,O,g.isActivated,m))})).filter(Boolean);return[...I,...A(m),...P,...f(m)]},"getTableKeyConstraints"),getClusteringKey:n(({clusteringKey:m,isParentActivated:I})=>{if(!Array.isArray(m)||m.length===0)return"";let P=n(({name:y})=>t(y),"mapName"),O=m.filter(y=>y.isActivated).map(P).join(", "),g=m.filter(y=>!y.isActivated).map(P).join(", ");return I?O.length===0?`// CLUSTER BY (${g})
`:g.length===0?`CLUSTER BY (${O})
`:`CLUSTER BY (${O}) //${g}
`:`CLUSTER BY (${m.map(P).join(", ")})
`},"getClusteringKey")}}});var Ct=W((gr,Rt)=>{"use strict";var ye=require("lodash");Rt.exports=r=>{let{tab:i}=r.require("@hackolade/ddl-fe-utils").general,{toOptions:t}=ae()(r),a=n((A,f,h="")=>A!=="custom"?`(
`+i(`TYPE=${A}
${t(f)}`)+`
)`:`(
`+i(`FORMAT_NAME='${h}'`)+`
)`,"getFileFormat"),E=n(A=>ye.isEmpty(A)?"":`STAGE_COPY_OPTIONS = (
`+i(t(A))+`
)`,"getCopyOptions"),u=n((A,f)=>{let h=ye.trim(i(A.filter(S=>!!ye.trim(S,`	
 `)).join(`
`)),`	
`);return ye.trim(f)?h+`
	`+f:h},"addOptions"),R=n(A=>A.TIMESTAMP?`${A.atOrBefore} (timestamp => ${A.TIMESTAMP})`:A.OFFSET?`${A.atOrBefore} (offset => ${A.OFFSET})`:A.STATEMENT?`${A.atOrBefore} (statement => '${A.STATEMENT}')`:"","getAtOrBefore"),l=n(A=>A.map(f=>`"${f.name}"`).join(", "),"mergeKeys");function G({targetLagTimeSpan:A,targetLagAmount:f,targetLagDownstream:h}){return!(A&&f)&&!h?"":`TARGET_LAG = ${h?"DOWNSTREAM":`'${f} ${A}'`}
`}n(G,"getTargetLag");function x(A){let f=n((h,S,m)=>S===m.length-1?`	${h}`:`	${h}
`,"mapStatement");return`AS
${A.split(`
`).map(f).join("")}`}return n(x,"getSelectStatement"),{getFileFormat:a,getCopyOptions:E,addOptions:u,getAtOrBefore:R,mergeKeys:l,getDynamicTableProps:n(({tableData:A,transient:f,tagsStatement:h,clusterKeys:S,comment:m,dataRetentionTime:I,copyGrants:P,columnDefinitions:O})=>{if(!A.dynamicTableProps)return{};let{selectStatement:g}=A,{targetLag:y,warehouse:$,refreshMode:_,initialize:p,maxDataExtensionTime:s,externalVolume:N,catalog:C,baseLocation:M}=A.dynamicTableProps;return{targetLag:G(y),warehouse:$?`WAREHOUSE = ${$}
`:"",selectStatement:g?x(g):"",externalVolume:N?`EXTERNAL_VOLUME = '${N}'
`:"",catalog:C?`CATALOG = '${C}'
`:"",baseLocation:M?`BASE_LOCATION = '${M}'
`:"",column_definitions:O?`	(
		${O}
	)
`:"",refreshMode:_?`REFRESH_MODE = ${_}
`:"",initialize:p?`INITIALIZE = ${p}
`:"",clusterKeys:S,dataRetentionTime:I?`${I.trim()}
`:"",maxDataExtensionTime:s?`MAX_DATA_EXTENSION_TIME_IN_DAYS = ${s}
`:"",copyGrants:P?`${P.trim()}
`:"",comment:m?`${m.trim()}
`:"",tagsStatement:h?`${h.trim()}
`:""}},"getDynamicTableProps")}}});var ft=W((Rr,_t)=>{"use strict";var Bn=require("lodash"),Ot=n(r=>Array.isArray(r)?r.filter(i=>i&&i.NULL_IF_item):[],"getNullIf"),xn=n(r=>(i,t)=>{let{toString:a,toStringIfNotNone:E,toStringIfNotAuto:u,toNumber:R,toBoolean:l}=ae()(r);switch(i){case"CSV":return{COMPRESSION:t.COMPRESSION,RECORD_DELIMITER:E(t.RECORD_DELIMITER),FIELD_DELIMITER:E(t.FIELD_DELIMITER),FILE_EXTENSION:E(t.FILE_EXTENSION),SKIP_HEADER:R(t.SKIP_HEADER),DATE_FORMAT:u(t.DATE_FORMAT),TIME_FORMAT:u(t.TIME_FORMAT),TIMESTAMP_FORMAT:u(t.TIMESTAMP_FORMAT),BINARY_FORMAT:t.BINARY_FORMAT,ESCAPE:E(t.ESCAPE),ESCAPE_UNENCLOSED_FIELD:E(t.ESCAPE_UNENCLOSED_FIELD),TRIM_SPACE:l(t.TRIM_SPACE),FIELD_OPTIONALLY_ENCLOSED_BY:E(t.FIELD_OPTIONALLY_ENCLOSED_BY),NULL_IF:Bn.isEmpty(Ot(t.NULL_IF))?[]:Ot(t.NULL_IF).map(G=>a(G.NULL_IF_item)),ERROR_ON_COLUMN_COUNT_MISMATCH:l(t.ERROR_ON_COLUMN_COUNT_MISMATCH),VALIDATE_UTF8:l(t.VALIDATE_UTF8),EMPTY_FIELD_AS_NULL:l(t.EMPTY_FIELD_AS_NULL),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK),ENCODING:a(t.ENCODING)};case"JSON":return{COMPRESSION:t.COMPRESSION,FILE_EXTENSION:E(t.FILE_EXTENSION),ENABLE_OCTAL:l(t.ENABLE_OCTAL),ALLOW_DUPLICATE:l(t.ALLOW_DUPLICATE),STRIP_OUTER_ARRAY:l(t.STRIP_OUTER_ARRAY),STRIP_NULL_VALUES:l(t.STRIP_NULL_VALUES),IGNORE_UTF8_ERRORS:l(t.IGNORE_UTF8_ERRORS),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK)};case"AVRO":return{COMPRESSION:t.COMPRESSION};case"PARQUET":return{COMPRESSION:t.SNAPPY_COMPRESSION?void 0:t.COMPRESSION,SNAPPY_COMPRESSION:t.SNAPPY_COMPRESSION?l(t.SNAPPY_COMPRESSION):void 0,BINARY_AS_TEXT:l(t.BINARY_AS_TEXT)};case"XML":return{COMPRESSION:t.COMPRESSION,IGNORE_UTF8_ERRORS:l(t.IGNORE_UTF8_ERRORS),PRESERVE_SPACE:l(t.PRESERVE_SPACE),STRIP_OUTER_ELEMENT:l(t.STRIP_OUTER_ELEMENT),DISABLE_SNOWFLAKE_DATA:l(t.DISABLE_SNOWFLAKE_DATA),DISABLE_AUTO_CONVERT:l(t.DISABLE_AUTO_CONVERT),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK)};default:return{}}},"getFormatTypeOptions");_t.exports=xn});var Mt=W((Or,$t)=>{"use strict";$t.exports=r=>{let{toNumber:i,toBoolean:t}=ae()(r),a=n(u=>u.ON_ERROR==="SKIP_FILE_<num>"?`SKIP_FILE_${u.skipFileNum}`:u.ON_ERROR==="SKIP_FILE_<num>%"?`SKIP_FILE_${u.skipFileNumPct}%`:u.ON_ERROR,"getOnError");return{getStageCopyOptions:n(u=>({ON_ERROR:a(u),SIZE_LIMIT:u.sizeLimit?i(u.SIZE_LIMIT):void 0,PURGE:t(u.PURGE),MATCH_BY_COLUMN_NAME:u.MATCH_BY_COLUMN_NAME,ENFORCE_LENGTH:t(u.ENFORCE_LENGTH),RETURN_FAILED_ONLY:t(u.RETURN_FAILED_ONLY),TRUNCATECOLUMNS:t(u.TRUNCATECOLUMNS),LOAD_UNCERTAIN_FILES:u.LOAD_UNCERTAIN_FILES?t(u.LOAD_UNCERTAIN_FILES):void 0,FORCE:t(u.FORCE)}),"getStageCopyOptions")}}});var Ft=W((fr,Pt)=>{"use strict";var qn=Ye(),j=require("lodash"),{escapeString:Lt}=Ne();Pt.exports=r=>{let i=r.require("@hackolade/ddl-fe-utils").assignTemplates,t=n((S,m)=>{S=j.toUpper(S);let I=S;return u(S)&&m.timePrecision&&!j.isNaN(m.timePrecision)&&(I=`${S}(${m.timePrecision})`),["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(S)&&m.length&&!j.isNaN(m.length)&&(I=`${S}(${m.length})`),["NUMBER","DECIMAL","NUMERIC"].includes(S)&&!j.isNaN(m.scale)&&!j.isNaN(m.precision)&&(I=`${S}(${Number(m.precision)},${Number(m.scale)})`),I},"decorateType"),a=n(S=>["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(j.toUpper(S)),"isString"),E=n(S=>["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","BYTEINT","TINYINT","SMALLINT","REAL","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION"].includes(j.toUpper(S)),"isNumber"),u=n(S=>["TIME","TIMESTAMP_NTZ","TIMESTAMP_TZ","TIMESTAMP_LTZ","TIMESTAMP","TIMESTAMPNTZ","TIMESTAMPTZ","TIMESTAMPLTZ","DATETIME"].includes(j.toUpper(S)),"isTimestamp"),R=n(S=>S.replace(/^'([\S\s]+)'$/,"$1"),"localEscapeString"),l=n(({type:S,defaultValue:m,scriptFormat:I})=>a(S)?Lt(I,R(String(m))):j.toUpper(S)==="BOOLEAN"?j.toUpper(m):m,"getDefault"),G=n((S,m,I)=>{if(!I||!E(S))return"";let P=` ${m}`;return P+=!j.isNaN(I.step)&&(I.start||I.start===0)?" START "+I.start:"",P+=!j.isNaN(I.step)&&I.step?" INCREMENT "+I.step:"",P},"getAutoIncrement"),x=n((S,m)=>!a(S)||j.isEmpty(m)?"":" COLLATE '"+Object.entries(m).map(([I,P])=>P).join("-")+"'","getCollation"),b=n(S=>S.unique&&!S.compositeUniqueKey?" UNIQUE":"","getUnique"),A=n(S=>!S.primaryKey||S.compositePrimaryKey?"":" PRIMARY KEY","getPrimaryKey");return{decorateType:t,getDefault:l,getAutoIncrement:G,getCollation:x,getInlineConstraint:n(S=>A(S)+b(S),"getInlineConstraint"),createExternalColumn:n(S=>({statement:i(qn.externalColumnDefinition,{name:S.name,type:t(S.type,S),expression:S.expression?`(${S.expression})`:`(value:${S.name}::${S.type})`,comment:S.comment?` COMMENT ${Lt(S.comment)}`:""}),isActivated:S.isActivated}),"createExternalColumn")}}});var Ut=W((Mr,Kt)=>{"use strict";Kt.exports=r=>{let{foreignKeysToString:i,foreignActiveKeysToString:t,getName:a}=ae()(r);return{generateConstraint:n(({name:u,keys:R,keyType:l,isParentActivated:G,isCaseSensitive:x})=>{let b=R.map(h=>({...h,name:`${a(x,h.name)}`})),A=b.some(h=>h.isActivated),f=t(x,b);return A&&G&&(f=i(x,b)),{statement:(u!=="undefined"?`CONSTRAINT ${a(x,u)} `:"")+`${l} (${f})`,isActivated:A}},"generateConstraint")}}});var Yt=W((Pr,ht)=>{"use strict";var xe=require("lodash"),{escapeString:Vn}=Ne();ht.exports=({getName:r,getFullName:i,templates:t,assignTemplates:a,tab:E})=>{let u=n((O,g,y)=>{let $=r(y,g),_=r(y,O);return i(_,$)},"getSchemaFullName"),R=n(({database:O,isCaseSensitive:g,newName:y}={})=>{let $=u(O,y,g);return a(t.alterSchemaScript,{name:$})},"getAlterSchemaScript"),l=n((O,{dynamic:g,database:y,isCaseSensitive:$,newName:_,schemaName:p}={})=>{let s=u(y,p,$),N=r($,_),C=i(s,N);return a(O,{dynamic:g?" DYNAMIC":"",name:C})},"getAlterEntityScript"),G=n(({script:O,data:g})=>{let{nameData:y}=g,{database:$,isCaseSensitive:_,oldName:p,nameIsChanged:s,newName:N}=y,C=u($,p,_),M=u($,N,_);if(s){let K=a(t.alterSchemaScript,{name:C});O=[...O,K+a(t.alterEntityRename,{name:M})]}return{script:O,data:g}},"getAlterSchemaName"),x={description:"COMMENT",targetLag:"TARGET_LAG",warehouse:"WAREHOUSE",DATA_RETENTION_TIME_IN_DAYS:"DATA_RETENTION_TIME_IN_DAYS",MAX_DATA_EXTENSION_TIME_IN_DAYS:"MAX_DATA_EXTENSION_TIME_IN_DAYS"},b=n(({key:O,propValue:g,data:y},$)=>{if(O==="description"){let _=xe.get(y,"options.targetScriptOptions.keyword");return Vn(_,g)}else if(O==="targetLag"){let{targetLagAmount:_,targetLagTimeSpan:p,targetLagDownstream:s}=y[$].targetLag??{};return s?"DOWNSTREAM":`'${_} ${p}'`}return g},"getValue");return{getAlterSchemaName:G,getSetCollectionProperty:n(O=>({script:g,data:y})=>{let{setProperty:$,nameData:_}=y;if(_!=null&&_.isExternal)return{script:g,data:y};let p=Object.keys($).map((s,N)=>{let C=$[s],M=b({key:s,data:y,propValue:C},"setProperty"),K=`${x[s]} = ${M}`;return N?E(K):K});if(!xe.isEmpty(p)){let s=O+a(t.setPropertySchema,{property:p.join(`
`)});g=[...g,s]}return{script:g,data:y}},"getSetCollectionProperty"),getUnsetCollectionProperty:n(O=>({script:g,data:y})=>{let{unsetProperty:$,nameData:_}=y;if(_!=null&&_.isExternal)return{script:g,data:y};let p=$.map((s,N)=>(s=x[s],N?`${s}`:`${s}`));if(!xe.isEmpty(p)){let s=O+a(t.unsetPropertySchema,{property:p.join(`
`)});g=[...g,s]}return{script:g,data:y}},"getUnsetCollectionProperty"),getSchemaMenageAccess:n(O=>({script:g,data:y})=>{let{managedAccess:$}=y;if($.isChange){let _=$.value?"ENABLE":"DISABLE";g=[...g,O+a(t.manageAccessSchema,{access:_})]}return{script:g,data:y}},"getSchemaMenageAccess"),getAlterSchemaScript:R,getAlterTableFormat:n((O,g)=>({script:y,data:$})=>{let{formatData:_,formatTypeOptions:p,nameData:s}=$;if(s.isExternal)return{script:y,data:$};let N=_.fileFormat,C=_.formatName,M=p.optionsIsChanged||_.isChangeType?p.typeOptions:{};if(_.isChangeType&&!_.fileFormat&&(N="CSV",M={}),N==="custom"&&!C)return{script:y,data:$};if(_.isChangeType||_.isChangeCustomFileFormat||p.optionsIsChanged){let K="STAGE_FILE_FORMAT = "+g(N,M||{},C);y=[...y,O+a(t.setPropertyTable,{property:K})]}return{script:y,data:$}},"getAlterTableFormat"),getAlterEntityScript:l,getAlterEntityRename:n((O,g)=>({script:y,data:$})=>{let{nameData:_}=$,{database:p,isCaseSensitive:s,oldName:N,nameIsChanged:C,newName:M,schemaName:K}=_,D=u(p,K,s),w=i(D,r(s,N)),Q=i(D,r(s,M));if(C&&!_.isExternal){let ce=a(O,{name:w});y=[...y,ce+a(g,{name:Q})]}return{script:y,data:$}},"getAlterEntityRename"),getAlterTableStageCopyOptions:n((O,g,y)=>({script:$,data:_})=>{let{stageCopyOptions:p,nameData:s}=_;if(p.optionsIsChanged&&!y.isEmpty(p.options)&&!(s!=null&&s.isExternal)){let N=g(p.options);$=[...$,O+a(t.setPropertyTable,{property:N})]}return{data:_,script:$}},"getAlterTableStageCopyOptions"),getAlterObjectTagsScript:n(O=>({script:g,data:y})=>{let $={tagsToSet:t.setPropertySchema,tagsToUnset:t.unsetPropertySchema};return Object.entries($).reduce((_,[p,s])=>{var M;let N=(M=_.data.tags)==null?void 0:M[p];if(!N)return _;let C=O+a(s,{property:N});return{..._,script:[..._.script,C]}},{script:g,data:y})},"getAlterObjectTagsScript")}}});var xt=W((Kr,Bt)=>{"use strict";var{differenceBy:Gn,some:bt,partition:vt,isEmpty:me}=require("lodash");Bt.exports=({getName:r,toString:i})=>{let t=n(({tags:b,isCaseSensitive:A,indent:f=" "})=>{if(x({tags:b}))return"";let h=E({tags:b,isCaseSensitive:A});return me(h)?"":`${f}WITH TAG ( ${h} )`},"getTagStatement"),a=n(({allowedValues:b=[]})=>{let A=b.filter(({value:f})=>f).map(({value:f})=>i(f)).join(", ");return me(A)?"":` ALLOWED_VALUES ${A}`},"getTagAllowedValues"),E=n(({tags:b,isCaseSensitive:A})=>b.filter(f=>f.tagName&&f.tagValue).map(f=>`${u({tagName:f.tagName,isCaseSensitive:A})} = ${i(f.tagValue)}`).join(", "),"getTagKeyValues"),u=n(({tagName:b,isCaseSensitive:A})=>b.split(".").map(f=>r(A||/\s/.test(f),f)).join("."),"getTagName"),R=n(({tags:b=[],oldTags:A=[],isCaseSensitive:f=!1})=>{let[h,S]=vt(b,({tagName:P})=>!bt(A,{tagName:P})),m=Gn(S,A,({tagName:P,tagValue:O})=>P&&O);return me(h)&&me(m)?"":`TAG ${E({tags:[...h,...m],isCaseSensitive:f})}`},"getSetTagValue"),l=n(({tags:b=[],oldTags:A=[],isCaseSensitive:f=!1})=>{let[h]=vt(A,({tagName:m})=>!bt(b,{tagName:m}));return me(h)?"":`TAG ${h.map(({tagName:m})=>u({tagName:m,isCaseSensitive:f})).join(", ")}`},"getUnsetTagValue"),G=n(b=>({collection:A,data:f})=>{var g,y,$;let h=(g=A==null?void 0:A.role)==null?void 0:g.isCaseSensitive,S=(($=(y=A==null?void 0:A.role)==null?void 0:y.compMod)==null?void 0:$[b])??{},{new:m,old:I}=S,P=R({tags:m,oldTags:I,isCaseSensitive:h}),O=l({tags:m,oldTags:I,isCaseSensitive:h});return{collection:A,data:{...f,tags:{tagsToSet:P,tagsToUnset:O}}}},"prepareObjectTagsData"),x=n(({tags:b})=>me(b)||b.every(A=>!A.tagName),"isEmptyTags");return{getTagStatement:t,getTagAllowedValues:a,getTagKeyValues:E,prepareObjectTagsData:G,getSetTagValue:R,getUnsetTagValue:l,isEmptyTags:x}}});var F=require("lodash"),wn=je(),qt=et(),V=Ye(),{LANGUAGES:Vt,FORMATS:Dn}=be(),{prepareAlterSetUnsetData:qe,prepareContainerName:Hn,prepareMenageContainerData:Xn,prepareName:Ve,prepareTableName:Gt,prepareCollectionFileFormat:Wn,prepareCollectionFormatTypeOptions:zn,prepareCollectionStageCopyOptions:Zn}=Et(),{escapeString:oe}=Ne(),{joinActivatedAndDeactivatedStatements:Qn}=At(),Jn=1,jn=1;module.exports=(r,i,t)=>{var We;let a=t.require("@hackolade/ddl-fe-utils").assignTemplates,{tab:E,hasType:u,clean:R}=t.require("@hackolade/ddl-fe-utils").general,l=((We=i==null?void 0:i.targetScriptOptions)==null?void 0:We.keyword)||Dn.SNOWSIGHT,G=It()(t),{getFileFormat:x,getCopyOptions:b,addOptions:A,getAtOrBefore:f,mergeKeys:h,getDynamicTableProps:S}=Ct()(t),m=ft()(t),{getStageCopyOptions:I}=Mt()(t),{toString:P,toBoolean:O,composeClusteringKey:g,foreignKeysToString:y,checkIfForeignKeyActivated:$,foreignActiveKeysToString:_,getName:p,getFullName:s,getDbName:N,viewColumnsToString:C}=ae()(t),{decorateType:M,getDefault:K,getAutoIncrement:D,getCollation:w,getInlineConstraint:Q,createExternalColumn:ce}=Ft()(t),{generateConstraint:Ee}=Ut()(t),{commentIfDeactivated:de}=Be(),{getAlterSchemaName:wt,getSetCollectionProperty:ge,getUnsetCollectionProperty:Ie,getSchemaMenageAccess:Dt,getAlterSchemaScript:Ht,getAlterEntityRename:Ge,getAlterTableFormat:Xt,getAlterTableStageCopyOptions:Wt,getAlterEntityScript:we,getAlterObjectTagsScript:Re}=Yt()({getName:p,getFullName:s,templates:V,assignTemplates:a,tab:E}),{getTagStatement:Ce,getTagAllowedValues:Oe,getTagKeyValues:zt,prepareObjectTagsData:_e,isEmptyTags:Zt}=xt()({getName:p,toString:P}),De=n((e,o=[],d=[],v=[])=>{let T=[...o,...d,...v].map(B=>e?de(B.statement,B):B.statement);return F.isEmpty(T)?"":`,
		`+T.join(`,
		`)},"getOutOfLineConstraints");function Qt(e){return e=e.replace(/^(\$\$|')/,o=>o+`
`),e=e.replace(/(\$\$|')$/,o=>`
	`+o),e}n(Qt,"insertNewlinesAtEdges");let fe=n(e=>e?" OR REPLACE":"","getOrReplaceStatement"),He=n(e=>e?`
	${Qt(oe(l,e))}`:"","getBodyStatement"),$e=n(e=>e?`
	COMMENT = '${e}'`:"","getCommentsStatement"),Xe=n(e=>e?`
	NOT NULL`:"","getNotNullStatement"),Jt=n(e=>e?" IF NOT EXISTS":"","getIfNotExistStatement");return{createSchema({schemaName:e,databaseName:o,transient:d,managedAccess:v,dataRetention:T,comment:B,udfs:H,procedures:c,sequences:ee,fileFormats:k,stages:X,isCaseSensitive:q,tags:ie,schemaTags:ne}){let re=d?" TRANSIENT":"",L=!isNaN(T)&&T?`
	DATA_RETENTION_TIME_IN_DAYS=${T}`:"",U=v?`
	WITH MANAGED ACCESS`:"",J=B?`
	COMMENT=${oe(l,B)}`:"",z=p(q,e),te=p(q,o),ue=s(te,z),Me=a(V.createSchema,{name:ue,transient:re,managed_access:U,data_retention:L,comment:J}),le=n(Y=>{if(!Y)return;let{language:Pe,runtimeVersion:Ae,handler:pe,packages:Te}=Y;if([Vt.SQL,Vt.JAVASCRIPT].includes(Pe))return;let Fe=Ae?`
	RUNTIME_VERSION = '${Ae}'`:"",Ke=pe?`
	HANDLER = '${pe}'`:"",Ue=Te?`
	PACKAGES = (${n(()=>Te.map(({packageName:he})=>`'${he}'`).join(", "),"joinPackages")()})`:"";return`${Fe}${Ke}${Ue}`},"getParameters"),jt=H.map(Y=>a(V.createUDF,{name:s(z,p(q,Y.name)),arguments:(Y.arguments||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:Y.returnType,language:Y.language,body:He(Y.function),comment:$e(Y.comment),orReplace:fe(Y.orReplace),parameters:le(Y),notNull:Xe(Y.notNull)})),kt=c.map(({name:Y,orReplace:Pe,args:Ae,returnType:pe,language:Te,runtimeVersion:Ze,packages:Fe,handler:Ke,body:Qe,description:Ue,notNull:he})=>a(V.createProcedure,{orReplace:fe(Pe),name:s(z,p(q,Y)),arguments:(Ae||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:pe,language:Te,parameters:le({language:Te,runtimeVersion:Ze,handler:Ke,packages:Fe}),comment:$e(Ue),body:He(Qe),notNull:Xe(he)})),en=ee.map(Y=>a(V.createSequence,{name:s(z,p(q,Y.name)),start:Y.start,increment:Y.increment,comment:Y.comment})),tn=k.map(Y=>a(V.createFileFormat,{name:s(z,p(q,Y.name)),options:x(Y.type,Y.formatTypeOptions).slice(1,-1),comment:Y.comment})),nn=X.map(Y=>a(V.createStage,{name:s(z,p(q,Y.name)),temporary:Y.temporary?" TEMPORARY":"",url:Y.url?`
	URL=${Y.url}`:"",storageIntegration:Y.storageIntegration?`
	STORAGE_INTEGRATION=${Y.storageIntegration}`:"",credentials:Y.credentials?`
	CREDENTIALS=(${Y.credentials})`:"",encryption:Y.encryption?`
	ENCRYPTION=(${Y.encryption})`:""})),ze=ie.map(Y=>this.createTag({tag:Y,schemaName:z,isCaseSensitive:q}));if(!Zt({tags:ne})){let Y=a(V.alterSchema,{name:ue,operation:"SET TAG",options:zt({tags:ne,isCaseSensitive:q})});ze.push(Y)}let Le=[];return o&&Le.push(a(V.createDatabase,{name:p(q,o)})),Le.push(Me),[...Le,...jt,...kt,...en,...tn,...nn,...ze].join(`
`)},hydrateJsonSchemaColumn(e,o){return e.type==="variant"?F.omit(e,["subtype","mode"]):e},createTable(e,o){let d=F.get(e,"schemaData.schemaName"),v=e.temporary?" TEMPORARY":"",T=e.transient&&!e.temporary?" TRANSIENT":"",B=e.orReplace?" OR REPLACE":"",H=e.tableIfNotExists?" IF NOT EXISTS":"",c=F.isEmpty(e.clusteringKey)?"":" CLUSTER BY ("+(o?y(e.isCaseSensitive,e.clusteringKey):_(e.isCaseSensitive,e.clusteringKey))+")",ee=F.isEmpty(e.partitioningKey)?"":" PARTITION BY ("+(o?y(e.isCaseSensitive,e.partitioningKey.map(te=>({name:`${p(e.isCaseSensitive,te.name)}`,isActivated:te.isActivated}))):h(e.partitioningKey))+")",k=e.comment?` COMMENT=${oe(l,e.comment)}`:"",X=e.copyGrants?" COPY GRANTS":"",q=e.dataRetentionTime?` DATA_RETENTION_TIME_IN_DAYS=${e.dataRetentionTime}`:"",ie=e.fileFormat?E("STAGE_FILE_FORMAT = "+x(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",ne=e.fileFormat?E("FILE_FORMAT = "+x(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",re=E(b(e.copyOptions)," "),L=E(f(e.cloneParams)," "),U=e.columns.map(te=>de(te.statement,te)),J=Qn({statements:U,indent:`
		`}),z=Ce({tags:e.tableTags,isCaseSensitive:e.isCaseSensitive});if(e.dynamic){let te=S({iceberg:e.iceberg,tableData:e,tagsStatement:z,clusterKeys:c,comment:k,dataRetentionTime:q,copyGrants:X,columnDefinitions:J});return a(V.createDynamicTable,{orReplace:B,tableIfNotExists:H,name:e.fullName,transient:T,...te})}else{if(e.selectStatement)return a(V.createAsSelect,{name:e.fullName,selectStatement:e.selectStatement,tableOptions:A([c,X,z])});if(e.cloneTableName)return a(V.createCloneTable,{name:e.fullName,source_table:s(d,e.cloneTableName),tableOptions:A([L,X,z])});if(e.likeTableName)return a(V.createLikeTable,{name:e.fullName,source_table:s(d,e.likeTableName),tableOptions:A([c,X,z])});if(e.external){let te=e.externalOptions.location?" WITH LOCATION="+e.externalOptions.location:"",ue=e.externalOptions.REFRESH_ON_CREATE?" REFRESH_ON_CREATE="+e.externalOptions.REFRESH_ON_CREATE:"",Me=e.externalOptions.AUTO_REFRESH?" AUTO_REFRESH="+e.externalOptions.AUTO_REFRESH:"",le=e.externalOptions.PATTERN?" PATTERN="+e.externalOptions.PATTERN:"";return a(V.createExternalTable,{name:e.fullName,tableOptions:A([ee,ne,te,ue,Me,le,X,z],k),column_definitions:J,out_of_line_constraints:De(o,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})}}return a(V.createTable,{name:e.fullName,temporary:v,transient:T,tableOptions:A([c,ie,re,q,X,z],k),column_definitions:J,out_of_line_constraints:De(o,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})},convertColumnDefinition(e){return{statement:a(V.columnDefinition,{name:e.name,type:M(e.type,e),collation:w(e.type,e.collation),default:F.isUndefined(e.default)?"":" DEFAULT "+K({scriptFormat:l,type:e.type,defaultValue:e.default}),autoincrement:D(e.type,"AUTOINCREMENT",e.autoincrement),identity:D(e.type,"IDENTITY",e.identity),not_nul:e.nullable?"":" NOT NULL",inline_constraint:Q(e),comment:e.comment?` COMMENT ${oe(l,e.comment)}`:"",tag:Ce({tags:e.columnTags,isCaseSensitive:e.isCaseSensitive})}),isActivated:e.isActivated}},createForeignKeyConstraint(e,o,d){let v=$(e),T=v?y(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=v?y(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:a(V.createTableForeignKey,{constraint:e.name?`CONSTRAINT ${p(d.isCaseSensitive,e.name)} `:"",columns:T,primary_table:s(p(d.isCaseSensitive,e.primarySchemaName||d.schemaName),p(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:v}},createForeignKey(e,o,d){let v=$(e),T=v?y(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=v?y(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:a(V.alterTableForeignKey,{constraint:e.name?`CONSTRAINT ${p(d.isCaseSensitive,e.name)} `:"",table_name:s(e.foreignSchemaName,p(e.foreignTableIsCaseSensitive,e.foreignTable)),columns:T,primary_table:s(e.primarySchemaName,p(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:v}},createView(e,o,d){let v=F.get(e,"schemaData.schemaName"),{columnList:T,tableColumns:B,tables:H}=e.keys.reduce((X,q)=>(X.columnList.push({name:`${p(e.isCaseSensitive,q.alias||q.name)}`,isActivated:q.isActivated}),X.tableColumns.push({name:`${p(e.isCaseSensitive,q.entityName)}.${p(e.isCaseSensitive,q.name)}`,isActivated:q.isActivated}),q.entityName&&!X.tables.includes(q.entityName)&&X.tables.push(s(q.dbName,q.entityName)),X),{columnList:[],tableColumns:[],tables:[]});if(F.isEmpty(H)&&!e.selectStatement)return"";let c=e.selectStatement||`SELECT 
	${C(B,d)}
FROM ${H.join(" INNER JOIN ")}`,ee=Ce({tags:e.viewTags,isCaseSensitive:e.isCaseSensitive,indent:""}),k=e.materialized?G.getClusteringKey({clusteringKey:e.clusteringKey,isParentActivated:d}):void 0;return a(V.createView,{secure:e.secure?" SECURE":"",materialized:e.materialized?" MATERIALIZED":"",name:s(v,e.name),column_list:C(T,d),copy_grants:e.copyGrants?`COPY GRANTS
`:"",comment:e.comment?`COMMENT=${oe(l,e.comment)}
`:"",select_statement:c,tag:ee?ee+`
`:"",clustering:k})},getDefaultType(e){return wn[e]},getTypesDescriptors(){return qt},hasType(e){return u(qt,e)},hydrateColumn({columnDefinition:e,jsonSchema:o,dbData:d}){return{...e,name:p(o.isCaseSensitive,e.name),isCaseSensitive:o.isCaseSensitive,timePrecision:Number(o.tPrecision),autoincrement:o.defaultOption==="Autoincrement"&&o.autoincrement?{start:F.get(o,"autoincrement.start_num"),step:F.get(o,"autoincrement.step_num")}:!1,identity:o.defaultOption==="Identity"&&o.identity?{start:F.get(o,"identity.start_num"),step:F.get(o,"identity.step_num")}:!1,collation:o.collate?R({locale:o.locale,caseSensitivity:o.caseSensitivity,accentSensitivity:o.accentSensitivity,punctuationSensitivity:o.punctuationSensitivity,firstLetterPreference:o.firstLetterPreference,caseConversion:o.caseConversion,spaceTrimming:o.spaceTrimming}):{},comment:o.refDescription||o.description,unique:o.uniqueKeyConstraintName?!1:o.unique,primaryKeyConstraintName:o.primaryKeyConstraintName,compositePrimaryKey:o.compositePrimaryKey||o.primaryKeyConstraintName&&o.primaryKey,compositeUniqueKey:o.compositeUniqueKey||o.uniqueKeyConstraintName&&o.unique,uniqueKeyConstraintName:o.uniqueKeyConstraintName,primaryKey:o.primaryKeyConstraintName?!1:e.primaryKey,expression:o.expression,columnTags:o.columnTags??[]}},hydrateSchema(e,{udfs:o,procedures:d,sequences:v,fileFormats:T,stages:B,tags:H}={}){return{schemaName:p(e.isCaseSensitive,e.name),isCaseSensitive:e.isCaseSensitive,databaseName:e.database,comment:e.description,transient:e.transient,managedAccess:e.managedAccess,dataRetention:e.DATA_RETENTION_TIME_IN_DAYS,schemaTags:e.schemaTags,udfs:Array.isArray(o)?o.map(c=>R({name:c.name||void 0,orReplace:c.functionOrReplace||void 0,language:c.functionLanguage||c.storedProcLanguage||void 0,runtimeVersion:c.functionRuntimeVersion||void 0,packages:c.functionPackages||void 0,arguments:c.functionArguments||c.storedProcArgument||void 0,returnType:c.functionReturnType||c.storedProcDataType||void 0,notNull:c.functionNotNull||void 0,handler:c.functionHandler||void 0,function:c.functionBody||c.storedProcFunction?E(F.trim(c.functionBody||c.storedProcFunction)):void 0,comment:c.functionDescription||c.storedProcDescription?`${c.functionDescription||c.storedProcDescription}`:""})).filter(c=>c.name&&c.language&&c.returnType&&c.function):[],procedures:Array.isArray(d)?d.map(c=>R({name:c.name||void 0,orReplace:c.orReplace||void 0,args:c.inputArgs||void 0,returnType:c.returnType||void 0,notNull:c.notNull||void 0,language:c.language||void 0,runtimeVersion:c.runtimeVersion||void 0,packages:c.packages||void 0,handler:c.handler||void 0,body:c.body?E(F.trim(c.body)):void 0,description:c.description||void 0})).filter(c=>c.name):[],sequences:Array.isArray(v)?v.map(c=>R({name:c.name||void 0,start:c.sequenceStart||Jn,increment:c.sequenceIncrement||jn,comment:c.sequenceComments?` COMMENT=${oe(l,c.sequenceComments)}`:""})).filter(c=>c.name):[],fileFormats:Array.isArray(T)?T.map(c=>R({name:c.name||void 0,type:c.fileFormat,formatTypeOptions:R(m(c.fileFormat,c.formatTypeOptions)),comment:c.fileFormatComments?` COMMENT=${oe(l,c.fileFormatComments)}`:""})).filter(c=>c.name):[],stages:Array.isArray(B)?B.map(c=>R({name:c.name||void 0,temporary:c.temporary,url:c.url,storageIntegration:c.storageIntegration,credentials:c.credentials,encryption:c.encryption})).filter(c=>c.name):[],tags:Array.isArray(H)?H.map(c=>R({name:c.name||void 0,orReplace:c.orReplace||void 0,ifNotExist:c.ifNotExist||void 0,allowedValues:c.allowedValues||void 0,description:c.description||void 0})).filter(c=>c.name):[]}},hydrateTable({tableData:e,entityData:o,jsonSchema:d}){let v=G.getTableKeyConstraints({jsonSchema:d}),T=F.get(o,"[0]",{}),B=p(T.isCaseSensitive,F.get(e,"schemaData.schemaName")),H=p(T.isCaseSensitive,F.get(e,"schemaData.databaseName")),c=p(T.isCaseSensitive,e.name),ee=s(H,s(B,c)),k=n(L=>L.namespace?L.namespace+L.path:L.path,"getLocation"),X=T.external?T.externalFileFormat:T.fileFormat,q=v.filter(({keyType:L})=>L==="PRIMARY KEY").reduce((L,U)=>({...L,[U.name]:U.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),ie=v.filter(({keyType:L})=>L==="UNIQUE").reduce((L,U)=>({...L,[U.name]:U.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),ne=e.columnDefinitions.filter(L=>L.compositePrimaryKey).reduce((L,U)=>U.primaryKeyConstraintName?{...L,[U.primaryKeyConstraintName]:Array.isArray(L[U.primaryKeyConstraintName])?F.uniqBy([...L[U.primaryKeyConstraintName],{name:U.name,isActivated:U.isActivated}],"name"):[{name:U.name,isActivated:U.isActivated}]}:L,q),re=e.columnDefinitions.filter(L=>L.compositeUniqueKey).reduce((L,U)=>U.uniqueKeyConstraintName?{...L,[U.uniqueKeyConstraintName]:Array.isArray(L[U.uniqueKeyConstraintName])?F.uniqBy([...L[U.uniqueKeyConstraintName],{name:U.name,isActivated:U.isActivated}],"name"):[{name:U.name,isActivated:U.isActivated}]}:L,ie);return{...e,fullName:ee,name:p(T.isCaseSensitive,e.name),temporary:T.temporary,transient:T.transient,external:T.external,dynamic:T.dynamic,dynamicTableProps:{iceberg:T.iceberg,warehouse:T.warehouse,targetLag:T.targetLag,refreshMode:T.refreshMode,initialize:T.initialize,query:T.query,externalVolume:T.externalVolume,catalog:T.catalog,baseLocation:T.baseLocation,maxDataExtensionTime:isNaN(T.MAX_DATA_EXTENSION_TIME_IN_DAYS)?"":T.MAX_DATA_EXTENSION_TIME_IN_DAYS},selectStatement:T.selectStatement,isCaseSensitive:T.isCaseSensitive,clusteringKey:Array.isArray(T.clusteringKey)?T.clusteringKey.map(L=>g(T.isCaseSensitive,d,L)).filter(Boolean):[],partitioningKey:T.partitioningKey,comment:T.description,copyGrants:T.copyGrants,dataRetentionTime:isNaN(T.DATA_RETENTION_TIME_IN_DAYS)?"":T.DATA_RETENTION_TIME_IN_DAYS,fileFormat:X,formatName:T.customFileFormatName,formatTypeOptions:F.isEmpty(T.formatTypeOptions)?{}:R(m(X,T.formatTypeOptions)),copyOptions:F.isEmpty(T.stageCopyOptions)?{}:R(I(T.stageCopyOptions)),cloneTableName:p(T.isCaseSensitive,F.get(e,`relatedSchemas[${T.clone}].code`,"")),likeTableName:p(T.isCaseSensitive,F.get(e,`relatedSchemas[${T.like}].code`,"")),cloneParams:F.isEmpty(T.cloneParams)?{}:{atOrBefore:F.toUpper(T.cloneParams.atOrBefore),TIMESTAMP:T.cloneParams.TIMESTAMP,OFFSET:T.cloneParams.OFFSET,STATEMENT:T.cloneParams.STATEMENT},externalOptions:{location:F.isPlainObject(T.location)?k(T.location):"",REFRESH_ON_CREATE:O(T.REFRESH_ON_CREATE),AUTO_REFRESH:O(T.AUTO_REFRESH),PATTERN:T.PATTERN?P(T.PATTERN):""},columns:T.external?e.columnDefinitions.map(ce):e.columns,compositePrimaryKeys:Object.entries(ne).map(([L,U])=>Ee({name:L,keys:U,keyType:"PRIMARY KEY",isActivated:d.isActivated,isCaseSensitive:T.isCaseSensitive})),compositeUniqueKeys:Object.entries(re).map(([L,U])=>Ee({name:L,keys:U,keyType:"UNIQUE",isActivated:d.isActivated,isCaseSensitive:T.isCaseSensitive})),tableTags:T.tableTags??[]}},hydrateView({viewData:e,entityData:o}){let d=o[0],{databaseName:v,schemaName:T}=e.schemaData,B=p(d.isCaseSensitive,e.name),H=s(v,s(T,B));return{...e,name:p(d.isCaseSensitive,e.name),selectStatement:d.selectStatement,isCaseSensitive:d.isCaseSensitive,copyGrants:d.copyGrants,comment:d.description,secure:d.secure,materialized:d.materialized,fullName:H,clusteringKey:d.clusteringKey,viewTags:d.viewTags??[]}},hydrateViewColumn(e){var o,d,v;return e.entityName?{...e,name:p((o=e.definition)==null?void 0:o.isCaseSensitive,e.name),dbName:p((d=F.first(e.containerData))==null?void 0:d.isCaseSensitive,e.dbName),entityName:p((v=F.first(e.entityData))==null?void 0:v.isCaseSensitive,e.entityName)}:e},commentIfDeactivated(e,o,d){return de(e,o,d)},alterTable(e){if(e.iceberg)return"// Dynamic Iceberg tables are currently only supported for CREATE statements. Specifying DYNAMIC ICEBERG in any other command (for example, ALTER DYNAMIC ICEBERG TABLE <name>) results in an error.";let o=we(V.alterTableScript,{dynamic:e.dynamic,...e.nameData}),{script:d}=F.flow(Ge(V.alterTableScript,V.alterEntityRename),ge(o),Ie(o),Xt(o,x),Wt(o,b,F),Re(o))({data:e,script:[]});return d.join(`
`)},hydrateAlertTable(e){var v,T,B,H;let{data:o}=F.flow(Ve,Gt,Wn,zn,qe,Zn(R,I,F),_e("tableTags"))({collection:e,data:{}}),d=R(m(o.formatData.fileFormat,o.formatTypeOptions.typeOptions));return{...o,dynamic:e.role.dynamic,iceberg:((T=(v=e.compMod)==null?void 0:v.iceberg)==null?void 0:T.old)||((H=(B=e.compMod)==null?void 0:B.iceberg)==null?void 0:H.new),formatTypeOptions:{...o.formatTypeOptions,typeOptions:d}}},alterView(e){let{nameData:o}=e,d=o.isMaterialized?"alterMaterializedViewScript":"alterViewScript",v=we(V[d],o),{script:T}=F.flow(Ge(V[d],V.alterEntityRename),ge(v),Ie(v),Re(v))({data:e,script:[]});return T.join(`
`)},hydrateAlterView(e){let{data:o}=F.flow(Ve,Gt,qe,_e("viewTags"))({collection:e,data:{}});return o},alterSchema(e){let o=Ht(e==null?void 0:e.nameData),{script:d}=F.flow(wt,ge(o),Ie(o),Dt(o),Re(o))({data:e,script:[]});return d.join(`
`)},hydrateAlterSchema(e){return F.flow(Ve,Hn,qe,Xn,_e("schemaTags"))({collection:e,data:{}}).data},hydrateForDeleteSchema(e){let o=p(e.isCaseSensitive,N(e)),d=p(e.isCaseSensitive,e.database);return{name:s(d,o)}},dropSchema({name:e}){return a(V.dropSchema,{name:e})},createTag({tag:e,schemaName:o,isCaseSensitive:d}){return a(V.createTag,{orReplace:fe(e.orReplace),ifNotExist:Jt(e.ifNotExist),allowedValues:Oe({allowedValues:e.allowedValues}),name:s(o,p(d,e.name)),comment:$e(e.description)})},dropTag({tag:e,schemaName:o,isCaseSensitive:d}){return a(V.dropTag,{name:s(o,p(d,e.name))})},alterTag({tag:e,oldTag:o,schemaName:d,isCaseSensitive:v}){let T=s(d,p(v,o.name)),B=s(d,p(v,e.name)),H=F.flatMap(e.allowedValues,({value:U})=>U).filter(Boolean),c=F.flatMap(o.allowedValues,({value:U})=>U).filter(Boolean),ee=F.differenceBy(e.allowedValues,o.allowedValues,({value:U})=>U),k=F.differenceBy(o.allowedValues,e.allowedValues,({value:U})=>U),X=T!==B,q=o.description&&!e.description,ie=!q&&e.description!==o.description,ne=c.length&&!H.length,re=[],L=n((U,J)=>{if(U){let z=a(V.alterTag,J);re.push(z)}},"createAndPushStatement");return L(X,{ifExists:" IF EXISTS",name:T,option:"RENAME TO ",optionValue:p(v,e.name)}),L(ne,{name:B,option:"UNSET ALLOWED_VALUES"}),L(!ne&&!F.isEmpty(k),{ifExists:" IF EXISTS",name:B,option:"DROP",optionValue:Oe({allowedValues:k})}),L(!F.isEmpty(ee),{ifExists:" IF EXISTS",name:B,option:"ADD",optionValue:Oe({allowedValues:ee})}),L(q,{ifExists:" IF EXISTS",name:B,option:"UNSET COMMENT"}),L(ie,{ifExists:" IF EXISTS",name:B,option:"SET COMMENT = ",optionValue:P(e.description)}),re.join("")}}};
