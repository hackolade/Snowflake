"use strict";var tn=Object.defineProperty;var n=(s,a)=>tn(s,"name",{value:a,configurable:!0});var X=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports);var Je=X((Zn,Qe)=>{"use strict";Qe.exports={number:"NUMBER",string:"VARCHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BOOLEAN",document:"OBJECT",array:"ARRAY",objectId:"VARCHAR(24)",default:"CHAR"}});var ke=X((Qn,je)=>{"use strict";je.exports={NUMBER:{capacity:12,mode:"decimal"},DECIMAL:{capacity:12,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},BYTEINT:{capacity:1},TINYINT:{capacity:1},SMALLINT:{capacity:2},REAL:{capacity:4,mode:"floating"},FLOAT:{capacity:8,mode:"floating"},FLOAT4:{capacity:4,mode:"floating"},FLOAT8:{capacity:8,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},VARCHAR:{mode:"varying"},CHAR:{size:1},CHARACTER:{size:1},STRING:{mode:"varying"},TEXT:{mode:"text"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:8e3,mode:"binary"},BOOLEAN:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss.nn"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP_LTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMPLTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMP_NTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMPNTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},"TIMESTAMP WITHOUT TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMP_TZ:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMPTZ:{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH LOCAL TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},VARIANT:{format:"semi-structured"},OBJECT:{format:"semi-structured",mode:"object"},ARRAY:{format:"semi-structured",mode:"array"},GEOGRAPHY:{mode:"geography"}}});var Ke=X((Jn,et)=>{"use strict";et.exports={createDatabase:"CREATE DATABASE IF NOT EXISTS ${name};\nUSE DATABASE ${name};\n",createSchema:"CREATE${transient} SCHEMA IF NOT EXISTS ${name}${managed_access}${data_retention}${comment};\nUSE SCHEMA ${name};\n",dropSchema:"DROP SCHEMA IF EXISTS ${name};\n",createTable:"CREATE${temporary}${transient} TABLE IF NOT EXISTS\n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",createDynamicTable:"CREATE OR REPLACE${transient} DYNAMIC TABLE\n	${name}\n${column_definitions}${targetLag}${warehouse}${refreshMode}${initialize}${clusterKeys}${dataRetentionTime}${maxDataExtensionTime}${comment}${tagsStatement}${selectStatement};\n",createDynamicIcebergTable:"CREATE DYNAMIC ICEBERG${transient} TABLE\n	${name}\n${column_definitions}${targetLag}${warehouse}${externalVolume}${catalog}${baseLocation}${refreshMode}${initialize}${clusterKeys}${dataRetentionTime}${comment}${copyGrants}${tagsStatement}${selectStatement};\n",createLikeTable:"CREATE TABLE IF NOT EXISTS ${name} LIKE ${source_table}${tableOptions};\n",createCloneTable:"CREATE TABLE IF NOT EXISTS ${name} CLONE ${source_table}${tableOptions};\n",createAsSelect:"CREATE TABLE IF NOT EXISTS ${name} AS ${selectStatement}${tableOptions};\n",createExternalTable:"CREATE EXTERNAL TABLE IF NOT EXISTS \n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",columnDefinition:"${name} ${type}${collation}${default}${identity}${autoincrement}${not_nul}${inline_constraint}${comment}${tag}",externalColumnDefinition:"${name} ${type} as ${expression}${comment}",createTableForeignKey:"${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns})",alterTableForeignKey:"ALTER TABLE IF EXISTS ${table_name} ADD ${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns});",createView:"CREATE${secure}${materialized} VIEW IF NOT EXISTS ${name} (\n	${column_list}\n)\n${copy_grants}${comment}${tag}${clustering}AS ${select_statement};\n",createUDF:"CREATE${orReplace} FUNCTION ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createSequence:"CREATE SEQUENCE IF NOT EXISTS ${name} START ${start} INCREMENT ${increment}${comment};\n",createFileFormat:"CREATE FILE FORMAT IF NOT EXISTS ${name}${options}${comment};\n",createStage:"CREATE${temporary} STAGE IF NOT EXISTS ${name} ${url}${storageIntegration}${credentials}${encryption};\n",alterSchema:"ALTER SCHEMA IF EXISTS ${name} ${operation} ${options};",alterTable:"ALTER${dynamic} TABLE IF EXISTS ${name} ${action};",alterView:"ALTER${materialized} VIEW IF EXISTS ${name} ${action};",alterSchemaScript:"ALTER SCHEMA IF EXISTS ${name} ",alterTableScript:"ALTER${dynamic} TABLE IF EXISTS ${name} ",alterEntityRename:"RENAME TO ${name};\n",setPropertySchema:"SET ${property};\n",unsetPropertySchema:"UNSET ${property};\n",manageAccessSchema:"${access} MANAGED ACCESS;\n",setPropertyTable:"SET ${property};\n",alterViewScript:"ALTER VIEW IF EXISTS ${name} ",alterMaterializedViewScript:"ALTER MATERIALIZED VIEW ${name} ",createTag:"CREATE${orReplace} TAG${ifNotExist} ${name}${allowedValues}${comment};\n",dropTag:"DROP TAG IF EXISTS ${name};\n",alterTag:"ALTER TAG${ifExists} ${name} ${option}${optionValue};\n"}});var Ue=X((jn,tt)=>{"use strict";var nn=["DROP SCHEMA","DROP TABLE","DROP COLUMN","DROP VIEW","DROP TAG"],rn={JAVA:"java",JAVASCRIPT:"javascript",PYTHON:"python",SCALA:"scala",SQL:"sql"},sn={SNOWSIGHT:"snowSight",CLASSIC_UI:"classicUI"};tt.exports={DROP_STATEMENTS:nn,LANGUAGES:rn,FORMATS:sn}});var st=X((kn,rt)=>{"use strict";var an=require("lodash"),nt={ON_ERROR:"ABORT_STATEMENT",SIZE_LIMIT:null,PURGE:!0,RETURN_FAILED_ONLY:!1,MATCH_BY_COLUMN_NAME:"none",ENFORCE_LENGTH:!0,TRUNCATECOLUMNS:!1,FORCE:!1},on=n((s={},a={},t=[])=>t.reduce((o,E)=>an.isEqual(s[E],a[E])?o:!a[E]&&s[E]!==nt[E]?{...o,[E]:nt[E]}:a[E]?{...o,[E]:a[E]}:o,{}),"getDiffCopyOptionsByDefault");rt.exports={getDiffCopyOptionsByDefault:on}});var Tt=X((tr,ct)=>{"use strict";var Ye=require("lodash"),{getDiffCopyOptionsByDefault:mn}=st(),it=["description","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS"],at=["targetLag","warehouse","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS","description"],cn=Ye.uniq([...it,...at]),Tn=["id"],En=n((s,a)=>a.some(t=>(s==null?void 0:s.oldField[t])!==(s==null?void 0:s.newField[t])),"checkFieldPropertiesChanged"),un=n(s=>({udfs:s.UDFs,sequences:s.sequences,fileFormats:s.fileFormats}),"prepareContainerLevelData"),ln=n((s,a,t)=>{let{schemaName:o,databaseName:E}=ot(s,a),A=a(s.isCaseSensitive,t(s));return{schemaName:o,databaseName:E,tableName:A}},"getNames"),ot=n((s,a)=>{var l;let{database:t,isCaseSensitive:o}=((l=s.compMod)==null?void 0:l.bucketProperties)||{},{keyspaceName:E}=s.compMod,A=a(o,E),O=a(o,t);return{schemaName:A,databaseName:O}},"getBaseAndContainerNames"),An=n(({collection:s,data:a})=>{let{database:t}=(s==null?void 0:s.role)||{};return a={...a,nameData:{...a.nameData||{},database:t}},{collection:s,data:a}},"prepareContainerName"),pn=n(({collection:s,data:a})=>{var o,E,A;let t=((o=s==null?void 0:s.role)==null?void 0:o.compMod)||{};return a={...a,nameData:{...a.nameData||{},isExternal:(E=s==null?void 0:s.role)==null?void 0:E.external,database:(A=t==null?void 0:t.bucketProperties)==null?void 0:A.database,schemaName:t==null?void 0:t.keyspaceName}},{collection:s,data:a}},"prepareTableName"),Nn=n((s={})=>{let a=s.code,t=s.name||s.collectionName;return{oldName:(a==null?void 0:a.old)||(t==null?void 0:t.old),newName:(a==null?void 0:a.new)||(t==null?void 0:t.new)}},"setName"),Sn=n(({collection:s,data:a})=>{let{compMod:t,isCaseSensitive:o,name:E,code:A,materialized:O}=(s==null?void 0:s.role)||{},l=Nn(t),G=(l==null?void 0:l.newName)!==(l==null?void 0:l.oldName);return a={...a,nameData:{...a.nameData||{},isCaseSensitive:o,nameIsChanged:G,isMaterialized:O,newName:(l==null?void 0:l.newName)||A||E,oldName:l==null?void 0:l.oldName}},{collection:s,data:a}},"prepareName"),yn=n(({collection:s,data:a})=>{let{compMod:t}=(s==null?void 0:s.role)||{},o=cn.reduce((E,A)=>{let{new:O,old:l}=(t==null?void 0:t[A])||{};return l!==O?O&&at.includes(A)?{...E,set:{...E.set,[A]:O}}:l&&it.includes(A)?{...E,unset:[...E.unset,A]}:E:E},{set:{},unset:[]});return{collection:s,data:{...a,setProperty:o.set,unsetProperty:o.unset}}},"prepareAlterSetUnsetData"),dn=n(({collection:s,data:a})=>{var E,A;let t=(A=(E=s==null?void 0:s.role)==null?void 0:E.compMod)==null?void 0:A.managedAccess,o=t&&(t==null?void 0:t.new)!==(t==null?void 0:t.old);return{collection:s,data:{...a,managedAccess:{isChange:o,value:!!(t!=null&&t.new)}}}},"prepareMenageContainerData"),gn=n(({collection:s,data:a})=>{let t=(s==null?void 0:s.role)||{},o=t.compMod||{},{new:E,old:A}=o.fileFormat||{},{new:O,old:l}=o.customFileFormatName||{};return{collection:s,data:{...a,formatData:{isChangeCustomFileFormat:(O||l)&&O!==l,isChangeType:(E||A)&&E!==A,fileFormat:E||(t==null?void 0:t.fileFormat),formatName:O}}}},"prepareCollectionFileFormat"),mt=n((s={},a={})=>{let t=Object.keys(s),o=Object.keys(a);return Ye.union(t,o).filter(E=>!Tn.includes(E))},"getObjectCommonKeys"),In=n(({collection:s,data:a})=>{var O,l;let{new:t={},old:o={}}=((l=(O=s==null?void 0:s.role)==null?void 0:O.compMod)==null?void 0:l.formatTypeOptions)||{},A=mt(o,t).some(G=>!Ye.isEqual(t[G],o[G]));return{collection:s,data:{...a,formatTypeOptions:{optionsIsChanged:A,typeOptions:t}}}},"prepareCollectionFormatTypeOptions"),Rn=n((s,a,t)=>({collection:o,data:E})=>{var u,M;let{new:A={},old:O={}}=((M=(u=o==null?void 0:o.role)==null?void 0:u.compMod)==null?void 0:M.stageCopyOptions)||{},l=mt(O,A),G=l.some(Y=>!t.isEqual(A[Y],O[Y])),q=mn(O,A,l);q={...q,sizeLimit:t.has(q,"SIZE_LIMIT")};let b={optionsIsChanged:G,options:s(a(q))};return{collection:o,data:{...E,stageCopyOptions:b}}},"prepareCollectionStageCopyOptions");ct.exports={checkFieldPropertiesChanged:En,prepareContainerLevelData:un,getBaseAndContainerNames:ot,getNames:ln,prepareTableName:pn,prepareContainerName:An,prepareName:Sn,prepareAlterSetUnsetData:yn,prepareMenageContainerData:dn,prepareCollectionFileFormat:gn,prepareCollectionFormatTypeOptions:In,prepareCollectionStageCopyOptions:Rn}});var le=X((rr,Et)=>{"use strict";var{FORMATS:Cn}=Ue(),On=/(\\r|\\n|\\b|\\f|\\t|'|"|\\[0-9]{3}|\0|\\x5C[0-3]?[0-7]{1,2}|\x5C[xX][0-9A-Fa-f]{2}|\x5C[uU][0-9A-Fa-f]{4}|\\)/g,_n=n((s,a)=>s===Cn.SNOWSIGHT?`'${a.replace(On,"\\$1")}'`:`$$${a}$$`,"escapeString");Et.exports={escapeString:_n}});var At=X((ir,lt)=>{"use strict";var ut=n((s="")=>new RegExp("\\$\\{(.*?)}",s),"template"),fn=n(s=>s.match(ut("gi"))||[],"getAllTemplates"),$n=n(s=>(s.match(ut("i"))||[])[1],"parseTemplate"),Mn=n((s,a)=>fn(s).reduce((t,o)=>{let E=$n(o);return t.replace(o,()=>a[E]||a[E]===0?a[E]:"")},s),"assignTemplates");lt.exports=Mn});var he=X((or,pt)=>{"use strict";var Ln=require("lodash"),Pn=["//"],Fn=n((s,a,t)=>Ln.has(a,"isActivated")&&!a.isActivated?t?"// "+s:s.includes(`
`)?s.split(`
`).filter(Boolean).map(o=>"// "+o).join(`
`).concat(`
`):s?"// "+s:"":s,"commentIfDeactivated"),Kn=n((s="")=>Pn.some(a=>s.startsWith(a)),"queryIsDeactivated");pt.exports={commentIfDeactivated:Fn,queryIsDeactivated:Kn}});var ie=X((cr,Nt)=>{"use strict";var z=require("lodash"),Un=At(),{commentIfDeactivated:Ae}=he();Nt.exports=s=>{let{checkAllKeysActivated:a}=s.require("@hackolade/ddl-fe-utils").general,t=n(r=>String(r).replace(/'/g,"''").replace(/\\\\/g,"\\").replace(/\\/g,"\\\\"),"escape"),o=n(r=>z.isUndefined(r)?r:`'${t(r)}'`,"toString"),E=n(r=>z.toLower(r)==="none","isNone"),A=n(r=>z.toLower(r)==="auto","isAuto"),O=n(r=>E(r)?r:o(r),"toStringIfNotNone"),l=n(r=>A(r)?r:o(r),"toStringIfNotAuto"),G=n(r=>isNaN(r)?"":Number(r),"toNumber"),q=n(r=>r===!0?"TRUE":void 0,"toBoolean"),b=n(r=>Object.entries(r).filter(([N,R])=>!z.isEmpty(R)||R!==!1).map(([N,R])=>(Array.isArray(R)&&(R="("+R.filter(P=>!z.isEmpty(P)).join(", ")+")"),`${N}=${R}`)).join(`
`),"toOptions"),u=n((r,N,R)=>{if(N.GUID===r)return[{...N,name:R}];if(z.isPlainObject(N.properties)){let P=Object.keys(N.properties).reduce((U,D)=>{if(U.length)return U;let w=u(r,N.properties[D],D);return w?U.concat(w):U},[]);if(P.length)return[{...N,name:R}].concat(P)}else if(z.isArray(N.items)){let P=N.items.reduce((U,D)=>{if(U.length)return U;let w=u(r,D,"");return w?U.concat(w):U},[]);if(P.length)return[{...N,name:R}].concat(P)}else if(N.items){let P=u(r,N.items,"");if(P)return[{...N,name:R}].concat(P)}},"findJsonSchemaChain"),M=n((r,N,R)=>{let P=z.get(R,"clusteringKey[0].name",""),U=z.get(R,"clusteringKey[0].isActivated",!0),D=n(w=>String(w||"").includes("."),"isComplexName");if(R.expression)return{name:Un(R.expression,{name:F(r,P)}),isActivated:U,isExpression:!0};if(P&&!D(P))return{name:P,isActivated:U};{let w=z.get(R,"clusteringKey[0].keyId",""),Z=u(w,N);if(Array.isArray(Z)){let me=z.get(Z[Z.length-1],"type","").replace(/json/i,"").toLowerCase();return{name:`(${Z.map(Te=>F(r,Te.name)).filter(Boolean).join(":")}::${me})`,isActivated:U,isExpression:!0}}}},"composeClusteringKey"),Y=n((r,N)=>{if(Array.isArray(N)){let R=", ",P=[],U=N.reduce((D,w)=>{let Z=z.isString(w.name)?w.name.trim():w.trim();return w.isExpression||(Z=F(r,Z)),z.get(w,"isActivated",!0)?[...D,Z]:(P.push(Z),D)},[]).filter(Boolean);return U.length===0?Ae(P.join(R),{isActivated:!1},!0):P.length===0?U.join(R):U.join(R)+Ae(R+P.join(R),{isActivated:!1},!0)}return N},"foreignKeysToString"),S=n((r,N)=>N==null?void 0:N.map(R=>F(r,R.name.trim())).join(", "),"foreignActiveKeysToString"),m=n(r=>a(r.foreignKey)&&a(r.primaryKey)&&r.primaryTableActivated&&r.foreignTableActivated,"checkIfForeignKeyActivated"),I=n((r,N)=>{if(!N)return r.map(U=>U.name).join(`,
	`);let R=r.filter(U=>U.isActivated).map(U=>U.name),P=r.filter(U=>!U.isActivated).map(U=>U.name);return R.length===0?Ae(P.join(`,
	`),{isActivated:!1},!0):P.length===0?R.join(`,
	`):R.join(`,
	`)+`
	`+Ae(P.join(`,
	`),{isActivated:!1},!0)},"viewColumnsToString"),F=n((r,N)=>N&&(r?L(N):y(N)?N:L(N)),"getName"),C=n(r=>r&&(r.code||r.collectionName)||"","getEntityName"),g=n((r,N)=>r?`${r}.${N}`:N,"getFullName"),y=n(r=>/^[a-z_][a-z\d_$]*$/i.test(r),"isValidCaseInsensitiveName"),L=n(r=>/^".*"$/.test(r)?r:`"${r}"`,"addQuotes");return{escape:t,toString:o,isNone:E,isAuto:A,toStringIfNotNone:O,toStringIfNotAuto:l,toNumber:G,toBoolean:q,toOptions:b,composeClusteringKey:M,foreignKeysToString:Y,checkIfForeignKeyActivated:m,foreignActiveKeysToString:S,viewColumnsToString:I,getName:F,getEntityName:C,getFullName:g,getDbName:n(r=>z.get(r,"code")||z.get(r,"name",""),"getDbName"),addQuotes:L,getGroupItemsByCompMode:n(({newItems:r=[],oldItems:N=[]})=>{let R=r.filter(D=>!N.some(w=>w.id===D.id)),P=[],U=[];return N.forEach(D=>{let w=r.find(Z=>Z.id===D.id);w?z.isEqual(w,D)||U.push(w):P.push(D)}),{added:R,removed:P,modified:U}},"getGroupItemsByCompMode")}}});var yt=X((Er,St)=>{"use strict";var re=require("lodash");St.exports=s=>{let{clean:a}=s.require("@hackolade/ddl-fe-utils").general,{addQuotes:t}=ie()(s),o=n((m,I)=>Object.entries(m.properties).map(I),"mapProperties"),E=n(m=>!(m.compositeUniqueKey||!m.unique),"isUniqueKey"),A=n(m=>!(m.compositeUniqueKey||m.compositePrimaryKey||!m.primaryKey),"isPrimaryKey"),O=n((m,I,F,C)=>a({keyType:"UNIQUE",name:m.constraintName,columns:[{name:I,isActivated:F}],include:b(m.include||m.indexInclude||[],C),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydrateUniqueOptions"),l=n((m,I,F,C)=>a({keyType:"PRIMARY KEY",name:m.constraintName,columns:[{name:I,isActivated:F}],include:b(m.include||m.indexInclude||[],C),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydratePrimaryKeyOptions"),G=n((m,I)=>Object.keys(I).find(F=>I[F].GUID===m),"findName"),q=n((m,I)=>re.get(Object.values(I).find(F=>F.GUID===m),"isActivated",!0),"checkIfActivated"),b=n((m,I)=>re.map(m,F=>({name:G(F.keyId,I.properties),isActivated:q(F.keyId,I.properties)})),"getKeys"),u=n(m=>Array.isArray(m.primaryKey)?m.primaryKey.filter(I=>!re.isEmpty(I.compositePrimaryKey)).map(I=>({...l(I,null,null,m),columns:b(I.compositePrimaryKey,m)})):[],"getCompositePrimaryKeys"),M=n(m=>Array.isArray(m.uniqueKey)?m.uniqueKey.filter(I=>!re.isEmpty(I.compositeUniqueKey)).map(I=>({...O(I,null,null,m),columns:b(I.compositeUniqueKey,m)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:n(({jsonSchema:m})=>{if(!m.properties)return[];let I=o(m,([C,g])=>{if(A(g)){if(re.isEmpty(g.primaryKeyOptions))return}else return;return l(re.first(g.primaryKeyOptions),C,g.isActivated,m)}).filter(Boolean),F=re.flatten(o(m,([C,g])=>{if(E(g)){if(re.isEmpty(g.uniqueKeyOptions)||!Array.isArray(g.uniqueKeyOptions))return[]}else return[];return g.uniqueKeyOptions.map(y=>O(y,C,g.isActivated,m))})).filter(Boolean);return[...I,...u(m),...F,...M(m)]},"getTableKeyConstraints"),getClusteringKey:n(({clusteringKey:m,isParentActivated:I})=>{if(!Array.isArray(m)||m.length===0)return"";let F=n(({name:y})=>t(y),"mapName"),C=m.filter(y=>y.isActivated).map(F).join(", "),g=m.filter(y=>!y.isActivated).map(F).join(", ");return I?C.length===0?`// CLUSTER BY (${g})
`:g.length===0?`CLUSTER BY (${C})
`:`CLUSTER BY (${C}) //${g}
`:`CLUSTER BY (${m.map(F).join(", ")})
`},"getClusteringKey")}}});var gt=X((lr,dt)=>{"use strict";var pe=require("lodash");dt.exports=s=>{let{tab:a}=s.require("@hackolade/ddl-fe-utils").general,{toOptions:t}=ie()(s),o=n((u,M,Y="")=>u!=="custom"?`(
`+a(`TYPE=${u}
${t(M)}`)+`
)`:`(
`+a(`FORMAT_NAME='${Y}'`)+`
)`,"getFileFormat"),E=n(u=>pe.isEmpty(u)?"":`STAGE_COPY_OPTIONS = (
`+a(t(u))+`
)`,"getCopyOptions"),A=n((u,M)=>{let Y=pe.trim(a(u.filter(S=>!!pe.trim(S,`	
 `)).join(`
`)),`	
`);return pe.trim(M)?Y+`
	`+M:Y},"addOptions"),O=n(u=>u.TIMESTAMP?`${u.atOrBefore} (timestamp => ${u.TIMESTAMP})`:u.OFFSET?`${u.atOrBefore} (offset => ${u.OFFSET})`:u.STATEMENT?`${u.atOrBefore} (statement => '${u.STATEMENT}')`:"","getAtOrBefore"),l=n(u=>u.map(M=>`"${M.name}"`).join(", "),"mergeKeys");function G({targetLagTimeSpan:u,targetLagAmount:M,targetLagDownstream:Y}){return!(u&&M)&&!Y?"":`TARGET_LAG = ${Y?"DOWNSTREAM":`'${M} ${u}'`}
`}n(G,"getTargetLag");function q(u){let M=n((Y,S,m)=>S===m.length-1?`	${Y}`:`	${Y}
`,"mapStatement");return`AS
${u.split(`
`).map(M).join("")}`}return n(q,"getSelectStatement"),{getFileFormat:o,getCopyOptions:E,addOptions:A,getAtOrBefore:O,mergeKeys:l,getDynamicTableProps:n(({tableData:u,transient:M,tagsStatement:Y,clusterKeys:S,comment:m,dataRetentionTime:I,copyGrants:F,columnDefinitions:C})=>{if(!u.dynamicTableProps)return{};let{selectStatement:g}=u,{targetLag:y,warehouse:L,refreshMode:_,initialize:p,maxDataExtensionTime:r,externalVolume:N,catalog:R,baseLocation:P}=u.dynamicTableProps;return{targetLag:G(y),warehouse:L?`WAREHOUSE = ${L}
`:"",selectStatement:g?q(g):"",externalVolume:N?`EXTERNAL_VOLUME = '${N}'
`:"",catalog:R?`CATALOG = '${R}'
`:"",baseLocation:P?`BASE_LOCATION = '${P}'
`:"",column_definitions:C?`	(
		${C}
	)
`:"",refreshMode:_?`REFRESH_MODE = ${_}
`:"",initialize:p?`INITIALIZE = ${p}
`:"",clusterKeys:S,dataRetentionTime:I?`${I.trim()}
`:"",maxDataExtensionTime:r?`MAX_DATA_EXTENSION_TIME_IN_DAYS = ${r}
`:"",copyGrants:F?`${F.trim()}
`:"",comment:m?`${m.trim()}
`:"",tagsStatement:Y?`${Y.trim()}
`:""}},"getDynamicTableProps")}}});var Ct=X((pr,Rt)=>{"use strict";var Yn=require("lodash"),It=n(s=>Array.isArray(s)?s.filter(a=>a&&a.NULL_IF_item):[],"getNullIf"),hn=n(s=>(a,t)=>{let{toString:o,toStringIfNotNone:E,toStringIfNotAuto:A,toNumber:O,toBoolean:l}=ie()(s);switch(a){case"CSV":return{COMPRESSION:t.COMPRESSION,RECORD_DELIMITER:E(t.RECORD_DELIMITER),FIELD_DELIMITER:E(t.FIELD_DELIMITER),FILE_EXTENSION:E(t.FILE_EXTENSION),SKIP_HEADER:O(t.SKIP_HEADER),DATE_FORMAT:A(t.DATE_FORMAT),TIME_FORMAT:A(t.TIME_FORMAT),TIMESTAMP_FORMAT:A(t.TIMESTAMP_FORMAT),BINARY_FORMAT:t.BINARY_FORMAT,ESCAPE:E(t.ESCAPE),ESCAPE_UNENCLOSED_FIELD:E(t.ESCAPE_UNENCLOSED_FIELD),TRIM_SPACE:l(t.TRIM_SPACE),FIELD_OPTIONALLY_ENCLOSED_BY:E(t.FIELD_OPTIONALLY_ENCLOSED_BY),NULL_IF:Yn.isEmpty(It(t.NULL_IF))?[]:It(t.NULL_IF).map(G=>o(G.NULL_IF_item)),ERROR_ON_COLUMN_COUNT_MISMATCH:l(t.ERROR_ON_COLUMN_COUNT_MISMATCH),VALIDATE_UTF8:l(t.VALIDATE_UTF8),EMPTY_FIELD_AS_NULL:l(t.EMPTY_FIELD_AS_NULL),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK),ENCODING:o(t.ENCODING)};case"JSON":return{COMPRESSION:t.COMPRESSION,FILE_EXTENSION:E(t.FILE_EXTENSION),ENABLE_OCTAL:l(t.ENABLE_OCTAL),ALLOW_DUPLICATE:l(t.ALLOW_DUPLICATE),STRIP_OUTER_ARRAY:l(t.STRIP_OUTER_ARRAY),STRIP_NULL_VALUES:l(t.STRIP_NULL_VALUES),IGNORE_UTF8_ERRORS:l(t.IGNORE_UTF8_ERRORS),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK)};case"AVRO":return{COMPRESSION:t.COMPRESSION};case"PARQUET":return{COMPRESSION:t.SNAPPY_COMPRESSION?void 0:t.COMPRESSION,SNAPPY_COMPRESSION:t.SNAPPY_COMPRESSION?l(t.SNAPPY_COMPRESSION):void 0,BINARY_AS_TEXT:l(t.BINARY_AS_TEXT)};case"XML":return{COMPRESSION:t.COMPRESSION,IGNORE_UTF8_ERRORS:l(t.IGNORE_UTF8_ERRORS),PRESERVE_SPACE:l(t.PRESERVE_SPACE),STRIP_OUTER_ELEMENT:l(t.STRIP_OUTER_ELEMENT),DISABLE_SNOWFLAKE_DATA:l(t.DISABLE_SNOWFLAKE_DATA),DISABLE_AUTO_CONVERT:l(t.DISABLE_AUTO_CONVERT),SKIP_BYTE_ORDER_MARK:l(t.SKIP_BYTE_ORDER_MARK)};default:return{}}},"getFormatTypeOptions");Rt.exports=hn});var _t=X((Sr,Ot)=>{"use strict";Ot.exports=s=>{let{toNumber:a,toBoolean:t}=ie()(s),o=n(A=>A.ON_ERROR==="SKIP_FILE_<num>"?`SKIP_FILE_${A.skipFileNum}`:A.ON_ERROR==="SKIP_FILE_<num>%"?`SKIP_FILE_${A.skipFileNumPct}%`:A.ON_ERROR,"getOnError");return{getStageCopyOptions:n(A=>({ON_ERROR:o(A),SIZE_LIMIT:A.sizeLimit?a(A.SIZE_LIMIT):void 0,PURGE:t(A.PURGE),MATCH_BY_COLUMN_NAME:A.MATCH_BY_COLUMN_NAME,ENFORCE_LENGTH:t(A.ENFORCE_LENGTH),RETURN_FAILED_ONLY:t(A.RETURN_FAILED_ONLY),TRUNCATECOLUMNS:t(A.TRUNCATECOLUMNS),LOAD_UNCERTAIN_FILES:A.LOAD_UNCERTAIN_FILES?t(A.LOAD_UNCERTAIN_FILES):void 0,FORCE:t(A.FORCE)}),"getStageCopyOptions")}}});var Mt=X((dr,$t)=>{"use strict";var bn=Ke(),j=require("lodash"),{escapeString:ft}=le();$t.exports=s=>{let a=s.require("@hackolade/ddl-fe-utils").assignTemplates,t=n((S,m)=>{S=j.toUpper(S);let I=S;return A(S)&&m.timePrecision&&!j.isNaN(m.timePrecision)&&(I=`${S}(${m.timePrecision})`),["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(S)&&m.length&&!j.isNaN(m.length)&&(I=`${S}(${m.length})`),["NUMBER","DECIMAL","NUMERIC"].includes(S)&&!j.isNaN(m.scale)&&!j.isNaN(m.precision)&&(I=`${S}(${Number(m.precision)},${Number(m.scale)})`),I},"decorateType"),o=n(S=>["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(j.toUpper(S)),"isString"),E=n(S=>["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","BYTEINT","TINYINT","SMALLINT","REAL","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION"].includes(j.toUpper(S)),"isNumber"),A=n(S=>["TIME","TIMESTAMP_NTZ","TIMESTAMP_TZ","TIMESTAMP_LTZ","TIMESTAMP","TIMESTAMPNTZ","TIMESTAMPTZ","TIMESTAMPLTZ","DATETIME"].includes(j.toUpper(S)),"isTimestamp"),O=n(S=>S.replace(/^'([\S\s]+)'$/,"$1"),"localEscapeString"),l=n(({type:S,defaultValue:m,scriptFormat:I})=>o(S)?ft(I,O(String(m))):j.toUpper(S)==="BOOLEAN"?j.toUpper(m):m,"getDefault"),G=n((S,m,I)=>{if(!I||!E(S))return"";let F=` ${m}`;return F+=!j.isNaN(I.step)&&(I.start||I.start===0)?" START "+I.start:"",F+=!j.isNaN(I.step)&&I.step?" INCREMENT "+I.step:"",F},"getAutoIncrement"),q=n((S,m)=>!o(S)||j.isEmpty(m)?"":" COLLATE '"+Object.entries(m).map(([I,F])=>F).join("-")+"'","getCollation"),b=n(S=>S.unique&&!S.compositeUniqueKey?" UNIQUE":"","getUnique"),u=n(S=>!S.primaryKey||S.compositePrimaryKey?"":" PRIMARY KEY","getPrimaryKey");return{decorateType:t,getDefault:l,getAutoIncrement:G,getCollation:q,getInlineConstraint:n(S=>u(S)+b(S),"getInlineConstraint"),createExternalColumn:n(S=>({statement:a(bn.externalColumnDefinition,{name:S.name,type:t(S.type,S),expression:S.expression?`(${S.expression})`:`(value:${S.name}::${S.type})`,comment:S.comment?` COMMENT ${ft(S.comment)}`:""}),isActivated:S.isActivated}),"createExternalColumn")}}});var Pt=X((Ir,Lt)=>{"use strict";Lt.exports=s=>{let{foreignKeysToString:a,foreignActiveKeysToString:t,getName:o}=ie()(s);return{generateConstraint:n(({name:A,keys:O,keyType:l,isParentActivated:G,isCaseSensitive:q})=>{let b=O.map(Y=>({...Y,name:`${o(q,Y.name)}`})),u=b.some(Y=>Y.isActivated),M=t(q,b);return u&&G&&(M=a(q,b)),{statement:(A!=="undefined"?`CONSTRAINT ${o(q,A)} `:"")+`${l} (${M})`,isActivated:u}},"generateConstraint")}}});var Kt=X((Cr,Ft)=>{"use strict";var be=require("lodash"),{escapeString:vn}=le();Ft.exports=({getName:s,getFullName:a,templates:t,assignTemplates:o,tab:E})=>{let A=n((C,g,y)=>{let L=s(y,g),_=s(y,C);return a(_,L)},"getSchemaFullName"),O=n(({database:C,isCaseSensitive:g,newName:y}={})=>{let L=A(C,y,g);return o(t.alterSchemaScript,{name:L})},"getAlterSchemaScript"),l=n((C,{dynamic:g,database:y,isCaseSensitive:L,newName:_,schemaName:p}={})=>{let r=A(y,p,L),N=s(L,_),R=a(r,N);return o(C,{dynamic:g?" DYNAMIC":"",name:R})},"getAlterEntityScript"),G=n(({script:C,data:g})=>{let{nameData:y}=g,{database:L,isCaseSensitive:_,oldName:p,nameIsChanged:r,newName:N}=y,R=A(L,p,_),P=A(L,N,_);if(r){let U=o(t.alterSchemaScript,{name:R});C=[...C,U+o(t.alterEntityRename,{name:P})]}return{script:C,data:g}},"getAlterSchemaName"),q={description:"COMMENT",targetLag:"TARGET_LAG",warehouse:"WAREHOUSE",DATA_RETENTION_TIME_IN_DAYS:"DATA_RETENTION_TIME_IN_DAYS",MAX_DATA_EXTENSION_TIME_IN_DAYS:"MAX_DATA_EXTENSION_TIME_IN_DAYS"},b=n(({key:C,propValue:g,data:y},L)=>{if(C==="description"){let _=be.get(y,"options.targetScriptOptions.keyword");return vn(_,g)}else if(C==="targetLag"){let{targetLagAmount:_,targetLagTimeSpan:p,targetLagDownstream:r}=y[L].targetLag??{};return r?"DOWNSTREAM":`'${_} ${p}'`}return g},"getValue");return{getAlterSchemaName:G,getSetCollectionProperty:n(C=>({script:g,data:y})=>{let{setProperty:L,nameData:_}=y;if(_!=null&&_.isExternal)return{script:g,data:y};let p=Object.keys(L).map((r,N)=>{let R=L[r],P=b({key:r,data:y,propValue:R},"setProperty"),U=`${q[r]} = ${P}`;return N?E(U):U});if(!be.isEmpty(p)){let r=C+o(t.setPropertySchema,{property:p.join(`
`)});g=[...g,r]}return{script:g,data:y}},"getSetCollectionProperty"),getUnsetCollectionProperty:n(C=>({script:g,data:y})=>{let{unsetProperty:L,nameData:_}=y;if(_!=null&&_.isExternal)return{script:g,data:y};let p=L.map((r,N)=>(r=q[r],N?`${r}`:`${r}`));if(!be.isEmpty(p)){let r=C+o(t.unsetPropertySchema,{property:p.join(`
`)});g=[...g,r]}return{script:g,data:y}},"getUnsetCollectionProperty"),getSchemaMenageAccess:n(C=>({script:g,data:y})=>{let{managedAccess:L}=y;if(L.isChange){let _=L.value?"ENABLE":"DISABLE";g=[...g,C+o(t.manageAccessSchema,{access:_})]}return{script:g,data:y}},"getSchemaMenageAccess"),getAlterSchemaScript:O,getAlterTableFormat:n((C,g)=>({script:y,data:L})=>{let{formatData:_,formatTypeOptions:p,nameData:r}=L;if(r.isExternal)return{script:y,data:L};let N=_.fileFormat,R=_.formatName,P=p.optionsIsChanged||_.isChangeType?p.typeOptions:{};if(_.isChangeType&&!_.fileFormat&&(N="CSV",P={}),N==="custom"&&!R)return{script:y,data:L};if(_.isChangeType||_.isChangeCustomFileFormat||p.optionsIsChanged){let U="STAGE_FILE_FORMAT = "+g(N,P||{},R);y=[...y,C+o(t.setPropertyTable,{property:U})]}return{script:y,data:L}},"getAlterTableFormat"),getAlterEntityScript:l,getAlterEntityRename:n((C,g)=>({script:y,data:L})=>{let{nameData:_}=L,{database:p,isCaseSensitive:r,oldName:N,nameIsChanged:R,newName:P,schemaName:U}=_,D=A(p,U,r),w=a(D,s(r,N)),Z=a(D,s(r,P));if(R&&!_.isExternal){let me=o(C,{name:w});y=[...y,me+o(g,{name:Z})]}return{script:y,data:L}},"getAlterEntityRename"),getAlterTableStageCopyOptions:n((C,g,y)=>({script:L,data:_})=>{let{stageCopyOptions:p,nameData:r}=_;if(p.optionsIsChanged&&!y.isEmpty(p.options)&&!(r!=null&&r.isExternal)){let N=g(p.options);L=[...L,C+o(t.setPropertyTable,{property:N})]}return{data:_,script:L}},"getAlterTableStageCopyOptions"),getAlterObjectTagsScript:n(C=>({script:g,data:y})=>{let L={tagsToSet:t.setPropertySchema,tagsToUnset:t.unsetPropertySchema};return Object.entries(L).reduce((_,[p,r])=>{var P;let N=(P=_.data.tags)==null?void 0:P[p];if(!N)return _;let R=C+o(r,{property:N});return{..._,script:[..._.script,R]}},{script:g,data:y})},"getAlterObjectTagsScript")}}});var bt=X((_r,ht)=>{"use strict";var{differenceBy:Bn,some:Ut,partition:Yt,isEmpty:oe}=require("lodash");ht.exports=({getName:s,toString:a})=>{let t=n(({tags:b,isCaseSensitive:u,indent:M=" "})=>{if(q({tags:b}))return"";let Y=E({tags:b,isCaseSensitive:u});return oe(Y)?"":`${M}WITH TAG ( ${Y} )`},"getTagStatement"),o=n(({allowedValues:b=[]})=>{let u=b.filter(({value:M})=>M).map(({value:M})=>a(M)).join(", ");return oe(u)?"":` ALLOWED_VALUES ${u}`},"getTagAllowedValues"),E=n(({tags:b,isCaseSensitive:u})=>b.filter(M=>M.tagName&&M.tagValue).map(M=>`${A({tagName:M.tagName,isCaseSensitive:u})} = ${a(M.tagValue)}`).join(", "),"getTagKeyValues"),A=n(({tagName:b,isCaseSensitive:u})=>b.split(".").map(M=>s(u||/\s/.test(M),M)).join("."),"getTagName"),O=n(({tags:b=[],oldTags:u=[],isCaseSensitive:M=!1})=>{let[Y,S]=Yt(b,({tagName:F})=>!Ut(u,{tagName:F})),m=Bn(S,u,({tagName:F,tagValue:C})=>F&&C);return oe(Y)&&oe(m)?"":`TAG ${E({tags:[...Y,...m],isCaseSensitive:M})}`},"getSetTagValue"),l=n(({tags:b=[],oldTags:u=[],isCaseSensitive:M=!1})=>{let[Y]=Yt(u,({tagName:m})=>!Ut(b,{tagName:m}));return oe(Y)?"":`TAG ${Y.map(({tagName:m})=>A({tagName:m,isCaseSensitive:M})).join(", ")}`},"getUnsetTagValue"),G=n(b=>({collection:u,data:M})=>{var g,y,L;let Y=(g=u==null?void 0:u.role)==null?void 0:g.isCaseSensitive,S=((L=(y=u==null?void 0:u.role)==null?void 0:y.compMod)==null?void 0:L[b])??{},{new:m,old:I}=S,F=O({tags:m,oldTags:I,isCaseSensitive:Y}),C=l({tags:m,oldTags:I,isCaseSensitive:Y});return{collection:u,data:{...M,tags:{tagsToSet:F,tagsToUnset:C}}}},"prepareObjectTagsData"),q=n(({tags:b})=>oe(b)||b.every(u=>!u.tagName),"isEmptyTags");return{getTagStatement:t,getTagAllowedValues:o,getTagKeyValues:E,prepareObjectTagsData:G,getSetTagValue:O,getUnsetTagValue:l,isEmptyTags:q}}});var K=require("lodash"),xn=Je(),vt=ke(),x=Ke(),{LANGUAGES:Bt,FORMATS:qn}=Ue(),{prepareAlterSetUnsetData:ve,prepareContainerName:Vn,prepareMenageContainerData:Gn,prepareName:Be,prepareTableName:xt,prepareCollectionFileFormat:wn,prepareCollectionFormatTypeOptions:Dn,prepareCollectionStageCopyOptions:Hn}=Tt(),{escapeString:ae}=le(),Xn=1,Wn=1;module.exports=(s,a,t)=>{var De;let o=t.require("@hackolade/ddl-fe-utils").assignTemplates,{tab:E,hasType:A,clean:O}=t.require("@hackolade/ddl-fe-utils").general,l=((De=a==null?void 0:a.targetScriptOptions)==null?void 0:De.keyword)||qn.SNOWSIGHT,G=yt()(t),{getFileFormat:q,getCopyOptions:b,addOptions:u,getAtOrBefore:M,mergeKeys:Y,getDynamicTableProps:S}=gt()(t),m=Ct()(t),{getStageCopyOptions:I}=_t()(t),{toString:F,toBoolean:C,composeClusteringKey:g,foreignKeysToString:y,checkIfForeignKeyActivated:L,foreignActiveKeysToString:_,getName:p,getFullName:r,getDbName:N,viewColumnsToString:R}=ie()(t),{decorateType:P,getDefault:U,getAutoIncrement:D,getCollation:w,getInlineConstraint:Z,createExternalColumn:me}=Mt()(t),{generateConstraint:Te}=Pt()(t),{commentIfDeactivated:Ne}=he(),{getAlterSchemaName:qt,getSetCollectionProperty:Se,getUnsetCollectionProperty:ye,getSchemaMenageAccess:Vt,getAlterSchemaScript:Gt,getAlterEntityRename:xe,getAlterTableFormat:wt,getAlterTableStageCopyOptions:Dt,getAlterEntityScript:qe,getAlterObjectTagsScript:de}=Kt()({getName:p,getFullName:r,templates:x,assignTemplates:o,tab:E}),{getTagStatement:ge,getTagAllowedValues:Ie,getTagKeyValues:Ht,prepareObjectTagsData:Re,isEmptyTags:Xt}=bt()({getName:p,toString:F}),Ve=n((e,i=[],d=[],v=[])=>{let T=[...i,...d,...v].map(B=>e?Ne(B.statement,B):B.statement);return K.isEmpty(T)?"":`,
		`+T.join(`,
		`)},"getOutOfLineConstraints");function Wt(e){return e=e.replace(/^(\$\$|')/,i=>i+`
`),e=e.replace(/(\$\$|')$/,i=>`
	`+i),e}n(Wt,"insertNewlinesAtEdges");let Ce=n(e=>e?" OR REPLACE":"","getOrReplaceStatement"),Ge=n(e=>e?`
	${Wt(ae(l,e))}`:"","getBodyStatement"),Oe=n(e=>e?`
	COMMENT = '${e}'`:"","getCommentsStatement"),we=n(e=>e?`
	NOT NULL`:"","getNotNullStatement"),zt=n(e=>e?" IF NOT EXISTS":"","getIfNotExistStatement");return{createSchema({schemaName:e,databaseName:i,transient:d,managedAccess:v,dataRetention:T,comment:B,udfs:H,procedures:c,sequences:W,fileFormats:k,stages:Q,isCaseSensitive:V,tags:se,schemaTags:ne}){let te=d?" TRANSIENT":"",$=!isNaN(T)&&T?`
	DATA_RETENTION_TIME_IN_DAYS=${T}`:"",f=v?`
	WITH MANAGED ACCESS`:"",J=B?`
	COMMENT=${ae(l,B)}`:"",ee=p(V,e),_e=p(V,i),He=r(_e,ee),Zt=o(x.createSchema,{name:He,transient:te,managed_access:f,data_retention:$,comment:J}),Xe=n(h=>{if(!h)return;let{language:$e,runtimeVersion:Ee,handler:ue,packages:ce}=h;if([Bt.SQL,Bt.JAVASCRIPT].includes($e))return;let Me=Ee?`
	RUNTIME_VERSION = '${Ee}'`:"",Le=ue?`
	HANDLER = '${ue}'`:"",Pe=ce?`
	PACKAGES = (${n(()=>ce.map(({packageName:Fe})=>`'${Fe}'`).join(", "),"joinPackages")()})`:"";return`${Me}${Le}${Pe}`},"getParameters"),Qt=H.map(h=>o(x.createUDF,{name:r(ee,p(V,h.name)),arguments:(h.arguments||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:h.returnType,language:h.language,body:Ge(h.function),comment:Oe(h.comment),orReplace:Ce(h.orReplace),parameters:Xe(h),notNull:we(h.notNull)})),Jt=c.map(({name:h,orReplace:$e,args:Ee,returnType:ue,language:ce,runtimeVersion:ze,packages:Me,handler:Le,body:Ze,description:Pe,notNull:Fe})=>o(x.createProcedure,{orReplace:Ce($e),name:r(ee,p(V,h)),arguments:(Ee||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:ue,language:ce,parameters:Xe({language:ce,runtimeVersion:ze,handler:Le,packages:Me}),comment:Oe(Pe),body:Ge(Ze),notNull:we(Fe)})),jt=W.map(h=>o(x.createSequence,{name:r(ee,p(V,h.name)),start:h.start,increment:h.increment,comment:h.comment})),kt=k.map(h=>o(x.createFileFormat,{name:r(ee,p(V,h.name)),options:q(h.type,h.formatTypeOptions).slice(1,-1),comment:h.comment})),en=Q.map(h=>o(x.createStage,{name:r(ee,p(V,h.name)),temporary:h.temporary?" TEMPORARY":"",url:h.url?`
	URL=${h.url}`:"",storageIntegration:h.storageIntegration?`
	STORAGE_INTEGRATION=${h.storageIntegration}`:"",credentials:h.credentials?`
	CREDENTIALS=(${h.credentials})`:"",encryption:h.encryption?`
	ENCRYPTION=(${h.encryption})`:""})),We=se.map(h=>this.createTag({tag:h,schemaName:ee,isCaseSensitive:V}));if(!Xt({tags:ne})){let h=o(x.alterSchema,{name:He,operation:"SET TAG",options:Ht({tags:ne,isCaseSensitive:V})});We.push(h)}let fe=[];return i&&fe.push(o(x.createDatabase,{name:p(V,i)})),fe.push(Zt),[...fe,...Qt,...Jt,...jt,...kt,...en,...We].join(`
`)},hydrateJsonSchemaColumn(e,i){return e.type==="variant"?K.omit(e,["subtype","mode"]):e},createTable(e,i){let d=K.get(e,"schemaData.schemaName"),v=e.temporary?" TEMPORARY":"",T=e.transient&&!e.temporary?" TRANSIENT":"",B=K.isEmpty(e.clusteringKey)?"":" CLUSTER BY ("+(i?y(e.isCaseSensitive,e.clusteringKey):_(e.isCaseSensitive,e.clusteringKey))+")",H=K.isEmpty(e.partitioningKey)?"":" PARTITION BY ("+(i?y(e.isCaseSensitive,e.partitioningKey.map(f=>({name:`${p(e.isCaseSensitive,f.name)}`,isActivated:f.isActivated}))):Y(e.partitioningKey))+")",c=e.comment?` COMMENT=${ae(l,e.comment)}`:"",W=e.copyGrants?" COPY GRANTS":"",k=e.dataRetentionTime?` DATA_RETENTION_TIME_IN_DAYS=${e.dataRetentionTime}`:"",Q=e.fileFormat?E("STAGE_FILE_FORMAT = "+q(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",V=e.fileFormat?E("FILE_FORMAT = "+q(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",se=E(b(e.copyOptions)," "),ne=E(M(e.cloneParams)," "),te=e.columns.map(f=>Ne(f.statement,f)).join(`,
		`),$=ge({tags:e.tableTags,isCaseSensitive:e.isCaseSensitive});if(e.dynamic){let f=S({tableData:e,tagsStatement:$,clusterKeys:B,comment:c,dataRetentionTime:k,copyGrants:W,columnDefinitions:te}),J=e.dynamicTableProps.iceberg?x.createDynamicIcebergTable:x.createDynamicTable;return o(J,{name:e.fullName,transient:T,...f})}else{if(e.selectStatement)return o(x.createAsSelect,{name:e.fullName,selectStatement:e.selectStatement,tableOptions:u([B,W,$])});if(e.cloneTableName)return o(x.createCloneTable,{name:e.fullName,source_table:r(d,e.cloneTableName),tableOptions:u([ne,W,$])});if(e.likeTableName)return o(x.createLikeTable,{name:e.fullName,source_table:r(d,e.likeTableName),tableOptions:u([B,W,$])});if(e.external){let f=e.externalOptions.location?" WITH LOCATION="+e.externalOptions.location:"",J=e.externalOptions.REFRESH_ON_CREATE?" REFRESH_ON_CREATE="+e.externalOptions.REFRESH_ON_CREATE:"",ee=e.externalOptions.AUTO_REFRESH?" AUTO_REFRESH="+e.externalOptions.AUTO_REFRESH:"",_e=e.externalOptions.PATTERN?" PATTERN="+e.externalOptions.PATTERN:"";return o(x.createExternalTable,{name:e.fullName,tableOptions:u([H,V,f,J,ee,_e,W,$],c),column_definitions:te,out_of_line_constraints:Ve(i,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})}}return o(x.createTable,{name:e.fullName,temporary:v,transient:T,tableOptions:u([B,Q,se,k,W,$],c),column_definitions:te,out_of_line_constraints:Ve(i,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})},convertColumnDefinition(e){return{statement:o(x.columnDefinition,{name:e.name,type:P(e.type,e),collation:w(e.type,e.collation),default:K.isUndefined(e.default)?"":" DEFAULT "+U({scriptFormat:l,type:e.type,defaultValue:e.default}),autoincrement:D(e.type,"AUTOINCREMENT",e.autoincrement),identity:D(e.type,"IDENTITY",e.identity),not_nul:e.nullable?"":" NOT NULL",inline_constraint:Z(e),comment:e.comment?` COMMENT ${ae(l,e.comment)}`:"",tag:ge({tags:e.columnTags,isCaseSensitive:e.isCaseSensitive})}),isActivated:e.isActivated}},createForeignKeyConstraint(e,i,d){let v=L(e),T=v?y(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=v?y(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:o(x.createTableForeignKey,{constraint:e.name?`CONSTRAINT ${p(d.isCaseSensitive,e.name)} `:"",columns:T,primary_table:r(p(d.isCaseSensitive,e.primarySchemaName||d.schemaName),p(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:v}},createForeignKey(e,i,d){let v=L(e),T=v?y(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=v?y(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:o(x.alterTableForeignKey,{constraint:e.name?`CONSTRAINT ${p(d.isCaseSensitive,e.name)} `:"",table_name:r(e.foreignSchemaName,p(e.foreignTableIsCaseSensitive,e.foreignTable)),columns:T,primary_table:r(e.primarySchemaName,p(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:v}},createView(e,i,d){let v=K.get(e,"schemaData.schemaName"),{columnList:T,tableColumns:B,tables:H}=e.keys.reduce((Q,V)=>(Q.columnList.push({name:`${p(e.isCaseSensitive,V.alias||V.name)}`,isActivated:V.isActivated}),Q.tableColumns.push({name:`${p(e.isCaseSensitive,V.entityName)}.${p(e.isCaseSensitive,V.name)}`,isActivated:V.isActivated}),V.entityName&&!Q.tables.includes(V.entityName)&&Q.tables.push(r(V.dbName,V.entityName)),Q),{columnList:[],tableColumns:[],tables:[]});if(K.isEmpty(H)&&!e.selectStatement)return"";let c=e.selectStatement||`SELECT 
	${R(B,d)}
FROM ${H.join(" INNER JOIN ")}`,W=ge({tags:e.viewTags,isCaseSensitive:e.isCaseSensitive,indent:""}),k=e.materialized?G.getClusteringKey({clusteringKey:e.clusteringKey,isParentActivated:d}):void 0;return o(x.createView,{secure:e.secure?" SECURE":"",materialized:e.materialized?" MATERIALIZED":"",name:r(v,e.name),column_list:R(T,d),copy_grants:e.copyGrants?`COPY GRANTS
`:"",comment:e.comment?`COMMENT=${ae(l,e.comment)}
`:"",select_statement:c,tag:W?W+`
`:"",clustering:k})},getDefaultType(e){return xn[e]},getTypesDescriptors(){return vt},hasType(e){return A(vt,e)},hydrateColumn({columnDefinition:e,jsonSchema:i,dbData:d}){return{...e,name:p(i.isCaseSensitive,e.name),isCaseSensitive:i.isCaseSensitive,timePrecision:Number(i.tPrecision),autoincrement:i.defaultOption==="Autoincrement"&&i.autoincrement?{start:K.get(i,"autoincrement.start_num"),step:K.get(i,"autoincrement.step_num")}:!1,identity:i.defaultOption==="Identity"&&i.identity?{start:K.get(i,"identity.start_num"),step:K.get(i,"identity.step_num")}:!1,collation:i.collate?O({locale:i.locale,caseSensitivity:i.caseSensitivity,accentSensitivity:i.accentSensitivity,punctuationSensitivity:i.punctuationSensitivity,firstLetterPreference:i.firstLetterPreference,caseConversion:i.caseConversion,spaceTrimming:i.spaceTrimming}):{},comment:i.refDescription||i.description,unique:i.uniqueKeyConstraintName?!1:i.unique,primaryKeyConstraintName:i.primaryKeyConstraintName,compositePrimaryKey:i.compositePrimaryKey||i.primaryKeyConstraintName&&i.primaryKey,compositeUniqueKey:i.compositeUniqueKey||i.uniqueKeyConstraintName&&i.unique,uniqueKeyConstraintName:i.uniqueKeyConstraintName,primaryKey:i.primaryKeyConstraintName?!1:e.primaryKey,expression:i.expression,columnTags:i.columnTags??[]}},hydrateSchema(e,{udfs:i,procedures:d,sequences:v,fileFormats:T,stages:B,tags:H}={}){return{schemaName:p(e.isCaseSensitive,e.name),isCaseSensitive:e.isCaseSensitive,databaseName:e.database,comment:e.description,transient:e.transient,managedAccess:e.managedAccess,dataRetention:e.DATA_RETENTION_TIME_IN_DAYS,schemaTags:e.schemaTags,udfs:Array.isArray(i)?i.map(c=>O({name:c.name||void 0,orReplace:c.functionOrReplace||void 0,language:c.functionLanguage||c.storedProcLanguage||void 0,runtimeVersion:c.functionRuntimeVersion||void 0,packages:c.functionPackages||void 0,arguments:c.functionArguments||c.storedProcArgument||void 0,returnType:c.functionReturnType||c.storedProcDataType||void 0,notNull:c.functionNotNull||void 0,handler:c.functionHandler||void 0,function:c.functionBody||c.storedProcFunction?E(K.trim(c.functionBody||c.storedProcFunction)):void 0,comment:c.functionDescription||c.storedProcDescription?`${c.functionDescription||c.storedProcDescription}`:""})).filter(c=>c.name&&c.language&&c.returnType&&c.function):[],procedures:Array.isArray(d)?d.map(c=>O({name:c.name||void 0,orReplace:c.orReplace||void 0,args:c.inputArgs||void 0,returnType:c.returnType||void 0,notNull:c.notNull||void 0,language:c.language||void 0,runtimeVersion:c.runtimeVersion||void 0,packages:c.packages||void 0,handler:c.handler||void 0,body:c.body?E(K.trim(c.body)):void 0,description:c.description||void 0})).filter(c=>c.name):[],sequences:Array.isArray(v)?v.map(c=>O({name:c.name||void 0,start:c.sequenceStart||Xn,increment:c.sequenceIncrement||Wn,comment:c.sequenceComments?` COMMENT=${ae(l,c.sequenceComments)}`:""})).filter(c=>c.name):[],fileFormats:Array.isArray(T)?T.map(c=>O({name:c.name||void 0,type:c.fileFormat,formatTypeOptions:O(m(c.fileFormat,c.formatTypeOptions)),comment:c.fileFormatComments?` COMMENT=${ae(l,c.fileFormatComments)}`:""})).filter(c=>c.name):[],stages:Array.isArray(B)?B.map(c=>O({name:c.name||void 0,temporary:c.temporary,url:c.url,storageIntegration:c.storageIntegration,credentials:c.credentials,encryption:c.encryption})).filter(c=>c.name):[],tags:Array.isArray(H)?H.map(c=>O({name:c.name||void 0,orReplace:c.orReplace||void 0,ifNotExist:c.ifNotExist||void 0,allowedValues:c.allowedValues||void 0,description:c.description||void 0})).filter(c=>c.name):[]}},hydrateTable({tableData:e,entityData:i,jsonSchema:d}){let v=G.getTableKeyConstraints({jsonSchema:d}),T=K.get(i,"[0]",{}),B=p(T.isCaseSensitive,K.get(e,"schemaData.schemaName")),H=p(T.isCaseSensitive,K.get(e,"schemaData.databaseName")),c=p(T.isCaseSensitive,e.name),W=r(H,r(B,c)),k=n($=>$.namespace?$.namespace+$.path:$.path,"getLocation"),Q=T.external?T.externalFileFormat:T.fileFormat,V=v.filter(({keyType:$})=>$==="PRIMARY KEY").reduce(($,f)=>({...$,[f.name]:f.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),se=v.filter(({keyType:$})=>$==="UNIQUE").reduce(($,f)=>({...$,[f.name]:f.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),ne=e.columnDefinitions.filter($=>$.compositePrimaryKey).reduce(($,f)=>f.primaryKeyConstraintName?{...$,[f.primaryKeyConstraintName]:Array.isArray($[f.primaryKeyConstraintName])?K.uniqBy([...$[f.primaryKeyConstraintName],{name:f.name,isActivated:f.isActivated}],"name"):[{name:f.name,isActivated:f.isActivated}]}:$,V),te=e.columnDefinitions.filter($=>$.compositeUniqueKey).reduce(($,f)=>f.uniqueKeyConstraintName?{...$,[f.uniqueKeyConstraintName]:Array.isArray($[f.uniqueKeyConstraintName])?K.uniqBy([...$[f.uniqueKeyConstraintName],{name:f.name,isActivated:f.isActivated}],"name"):[{name:f.name,isActivated:f.isActivated}]}:$,se);return{...e,fullName:W,name:p(T.isCaseSensitive,e.name),temporary:T.temporary,transient:T.transient,external:T.external,dynamic:T.dynamic,dynamicTableProps:{iceberg:T.iceberg,warehouse:T.warehouse,targetLag:T.targetLag,refreshMode:T.refreshMode,initialize:T.initialize,query:T.query,externalVolume:T.externalVolume,catalog:T.catalog,baseLocation:T.baseLocation,maxDataExtensionTime:isNaN(T.MAX_DATA_EXTENSION_TIME_IN_DAYS)?"":T.MAX_DATA_EXTENSION_TIME_IN_DAYS},selectStatement:T.selectStatement,isCaseSensitive:T.isCaseSensitive,clusteringKey:Array.isArray(T.clusteringKey)?T.clusteringKey.map($=>g(T.isCaseSensitive,d,$)).filter(Boolean):[],partitioningKey:T.partitioningKey,comment:T.description,copyGrants:T.copyGrants,dataRetentionTime:isNaN(T.DATA_RETENTION_TIME_IN_DAYS)?"":T.DATA_RETENTION_TIME_IN_DAYS,fileFormat:Q,formatName:T.customFileFormatName,formatTypeOptions:K.isEmpty(T.formatTypeOptions)?{}:O(m(Q,T.formatTypeOptions)),copyOptions:K.isEmpty(T.stageCopyOptions)?{}:O(I(T.stageCopyOptions)),cloneTableName:p(T.isCaseSensitive,K.get(e,`relatedSchemas[${T.clone}].code`,"")),likeTableName:p(T.isCaseSensitive,K.get(e,`relatedSchemas[${T.like}].code`,"")),cloneParams:K.isEmpty(T.cloneParams)?{}:{atOrBefore:K.toUpper(T.cloneParams.atOrBefore),TIMESTAMP:T.cloneParams.TIMESTAMP,OFFSET:T.cloneParams.OFFSET,STATEMENT:T.cloneParams.STATEMENT},externalOptions:{location:K.isPlainObject(T.location)?k(T.location):"",REFRESH_ON_CREATE:C(T.REFRESH_ON_CREATE),AUTO_REFRESH:C(T.AUTO_REFRESH),PATTERN:T.PATTERN?F(T.PATTERN):""},columns:T.external?e.columnDefinitions.map(me):e.columns,compositePrimaryKeys:Object.entries(ne).map(([$,f])=>Te({name:$,keys:f,keyType:"PRIMARY KEY",isActivated:d.isActivated,isCaseSensitive:T.isCaseSensitive})),compositeUniqueKeys:Object.entries(te).map(([$,f])=>Te({name:$,keys:f,keyType:"UNIQUE",isActivated:d.isActivated,isCaseSensitive:T.isCaseSensitive})),tableTags:T.tableTags??[]}},hydrateView({viewData:e,entityData:i}){let d=i[0],{databaseName:v,schemaName:T}=e.schemaData,B=p(d.isCaseSensitive,e.name),H=r(v,r(T,B));return{...e,name:p(d.isCaseSensitive,e.name),selectStatement:d.selectStatement,isCaseSensitive:d.isCaseSensitive,copyGrants:d.copyGrants,comment:d.description,secure:d.secure,materialized:d.materialized,fullName:H,clusteringKey:d.clusteringKey,viewTags:d.viewTags??[]}},hydrateViewColumn(e){var i,d,v;return e.entityName?{...e,name:p((i=e.definition)==null?void 0:i.isCaseSensitive,e.name),dbName:p((d=K.first(e.containerData))==null?void 0:d.isCaseSensitive,e.dbName),entityName:p((v=K.first(e.entityData))==null?void 0:v.isCaseSensitive,e.entityName)}:e},commentIfDeactivated(e,i,d){return Ne(e,i,d)},alterTable(e){if(e.iceberg)return"// Dynamic Iceberg tables are currently only supported for CREATE statements. Specifying DYNAMIC ICEBERG in any other command (for example, ALTER DYNAMIC ICEBERG TABLE <name>) results in an error.";let i=qe(x.alterTableScript,{dynamic:e.dynamic,...e.nameData}),{script:d}=K.flow(xe(x.alterTableScript,x.alterEntityRename),Se(i),ye(i),wt(i,q),Dt(i,b,K),de(i))({data:e,script:[]});return d.join(`
`)},hydrateAlertTable(e){var v,T,B,H;let{data:i}=K.flow(Be,xt,wn,Dn,ve,Hn(O,I,K),Re("tableTags"))({collection:e,data:{}}),d=O(m(i.formatData.fileFormat,i.formatTypeOptions.typeOptions));return{...i,dynamic:e.role.dynamic,iceberg:((T=(v=e.compMod)==null?void 0:v.iceberg)==null?void 0:T.old)||((H=(B=e.compMod)==null?void 0:B.iceberg)==null?void 0:H.new),formatTypeOptions:{...i.formatTypeOptions,typeOptions:d}}},alterView(e){let{nameData:i}=e,d=i.isMaterialized?"alterMaterializedViewScript":"alterViewScript",v=qe(x[d],i),{script:T}=K.flow(xe(x[d],x.alterEntityRename),Se(v),ye(v),de(v))({data:e,script:[]});return T.join(`
`)},hydrateAlterView(e){let{data:i}=K.flow(Be,xt,ve,Re("viewTags"))({collection:e,data:{}});return i},alterSchema(e){let i=Gt(e==null?void 0:e.nameData),{script:d}=K.flow(qt,Se(i),ye(i),Vt(i),de(i))({data:e,script:[]});return d.join(`
`)},hydrateAlterSchema(e){return K.flow(Be,Vn,ve,Gn,Re("schemaTags"))({collection:e,data:{}}).data},hydrateForDeleteSchema(e){let i=p(e.isCaseSensitive,N(e)),d=p(e.isCaseSensitive,e.database);return{name:r(d,i)}},dropSchema({name:e}){return o(x.dropSchema,{name:e})},createTag({tag:e,schemaName:i,isCaseSensitive:d}){return o(x.createTag,{orReplace:Ce(e.orReplace),ifNotExist:zt(e.ifNotExist),allowedValues:Ie({allowedValues:e.allowedValues}),name:r(i,p(d,e.name)),comment:Oe(e.description)})},dropTag({tag:e,schemaName:i,isCaseSensitive:d}){return o(x.dropTag,{name:r(i,p(d,e.name))})},alterTag({tag:e,oldTag:i,schemaName:d,isCaseSensitive:v}){let T=r(d,p(v,i.name)),B=r(d,p(v,e.name)),H=K.flatMap(e.allowedValues,({value:f})=>f).filter(Boolean),c=K.flatMap(i.allowedValues,({value:f})=>f).filter(Boolean),W=K.differenceBy(e.allowedValues,i.allowedValues,({value:f})=>f),k=K.differenceBy(i.allowedValues,e.allowedValues,({value:f})=>f),Q=T!==B,V=i.description&&!e.description,se=!V&&e.description!==i.description,ne=c.length&&!H.length,te=[],$=n((f,J)=>{if(f){let ee=o(x.alterTag,J);te.push(ee)}},"createAndPushStatement");return $(Q,{ifExists:" IF EXISTS",name:T,option:"RENAME TO ",optionValue:p(v,e.name)}),$(ne,{name:B,option:"UNSET ALLOWED_VALUES"}),$(!ne&&!K.isEmpty(k),{ifExists:" IF EXISTS",name:B,option:"DROP",optionValue:Ie({allowedValues:k})}),$(!K.isEmpty(W),{ifExists:" IF EXISTS",name:B,option:"ADD",optionValue:Ie({allowedValues:W})}),$(V,{ifExists:" IF EXISTS",name:B,option:"UNSET COMMENT"}),$(se,{ifExists:" IF EXISTS",name:B,option:"SET COMMENT = ",optionValue:F(e.description)}),te.join("")}}};
