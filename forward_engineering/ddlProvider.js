"use strict";var en=Object.defineProperty;var n=(s,a)=>en(s,"name",{value:a,configurable:!0});var X=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports);var Je=X((zn,Qe)=>{"use strict";Qe.exports={number:"NUMBER",string:"VARCHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BOOLEAN",document:"OBJECT",array:"ARRAY",objectId:"VARCHAR(24)",default:"CHAR"}});var ke=X((Zn,je)=>{"use strict";je.exports={NUMBER:{capacity:12,mode:"decimal"},DECIMAL:{capacity:12,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},BYTEINT:{capacity:1},TINYINT:{capacity:1},SMALLINT:{capacity:2},REAL:{capacity:4,mode:"floating"},FLOAT:{capacity:8,mode:"floating"},FLOAT4:{capacity:4,mode:"floating"},FLOAT8:{capacity:8,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},VARCHAR:{mode:"varying"},CHAR:{size:1},CHARACTER:{size:1},STRING:{mode:"varying"},TEXT:{mode:"text"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:8e3,mode:"binary"},BOOLEAN:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss.nn"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP_LTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMPLTZ:{format:"YYYY-MM-DD hh:mm:ss.nnnnnnZ"},TIMESTAMP_NTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMPNTZ:{format:"YYYY-MM-DD hh:mm:ss.nnn"},"TIMESTAMP WITHOUT TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss.nnn"},TIMESTAMP_TZ:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMPTZ:{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH LOCAL TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},"TIMESTAMP WITH TIME ZONE":{format:"YYYY-MM-DD hh:mm:ss"},VARIANT:{format:"semi-structured"},OBJECT:{format:"semi-structured",mode:"object"},ARRAY:{format:"semi-structured",mode:"array"},GEOGRAPHY:{mode:"geography"}}});var Ke=X((Qn,et)=>{"use strict";et.exports={createDatabase:"CREATE DATABASE IF NOT EXISTS ${name};\nUSE DATABASE ${name};\n",createSchema:"CREATE${transient} SCHEMA IF NOT EXISTS ${name}${managed_access}${data_retention}${comment};\nUSE SCHEMA ${name};\n",dropSchema:"DROP SCHEMA IF EXISTS ${name};\n",createTable:"CREATE${temporary}${transient} TABLE IF NOT EXISTS\n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",createDynamicTable:"CREATE OR REPLACE${transient} DYNAMIC TABLE\n	${name}\n${column_definitions}${targetLag}${warehouse}${refreshMode}${initialize}${clusterKeys}${dataRetentionTime}${maxDataExtensionTime}${comment}${tagsStatement}${selectStatement};\n",createDynamicIcebergTable:"CREATE DYNAMIC ICEBERG${transient} TABLE\n	${name}\n${column_definitions}${targetLag}${warehouse}${externalVolume}${catalog}${baseLocation}${refreshMode}${initialize}${clusterKeys}${dataRetentionTime}${comment}${copyGrants}${tagsStatement}${selectStatement};\n",createLikeTable:"CREATE TABLE IF NOT EXISTS ${name} LIKE ${source_table}${tableOptions};\n",createCloneTable:"CREATE TABLE IF NOT EXISTS ${name} CLONE ${source_table}${tableOptions};\n",createAsSelect:"CREATE TABLE IF NOT EXISTS ${name} AS ${selectStatement}${tableOptions};\n",createExternalTable:"CREATE EXTERNAL TABLE IF NOT EXISTS \n	${name} (\n		${column_definitions}${out_of_line_constraints}\n	)${tableOptions};\n",columnDefinition:"${name} ${type}${collation}${default}${identity}${autoincrement}${not_nul}${inline_constraint}${comment}${tag}",externalColumnDefinition:"${name} ${type} as ${expression}${comment}",createTableForeignKey:"${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns})",alterTableForeignKey:"ALTER TABLE IF EXISTS ${table_name} ADD ${constraint}FOREIGN KEY (${columns}) REFERENCES ${primary_table} (${primary_columns});",createView:"CREATE${secure}${materialized} VIEW IF NOT EXISTS ${name} (\n	${column_list}\n)\n${copy_grants}${comment}${tag}${clustering}AS ${select_statement};\n",createUDF:"CREATE${orReplace} FUNCTION ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name}(${arguments})\n	RETURNS ${returnType}${notNull}\n	LANGUAGE ${language}${parameters}${comment}\n	AS ${body};\n",createSequence:"CREATE SEQUENCE IF NOT EXISTS ${name} START ${start} INCREMENT ${increment}${comment};\n",createFileFormat:"CREATE FILE FORMAT IF NOT EXISTS ${name}${options}${comment};\n",createStage:"CREATE${temporary} STAGE IF NOT EXISTS ${name} ${url}${storageIntegration}${credentials}${encryption};\n",alterSchema:"ALTER SCHEMA IF EXISTS ${name} ${operation} ${options};",alterTable:"ALTER${dynamic} TABLE IF EXISTS ${name} ${action};",alterView:"ALTER${materialized} VIEW IF EXISTS ${name} ${action};",alterSchemaScript:"ALTER SCHEMA IF EXISTS ${name} ",alterTableScript:"ALTER${dynamic} TABLE IF EXISTS ${name} ",alterEntityRename:"RENAME TO ${name};\n",setPropertySchema:"SET ${property};\n",unsetPropertySchema:"UNSET ${property};\n",manageAccessSchema:"${access} MANAGED ACCESS;\n",setPropertyTable:"SET ${property};\n",alterViewScript:"ALTER VIEW IF EXISTS ${name} ",alterMaterializedViewScript:"ALTER MATERIALIZED VIEW ${name} ",createTag:"CREATE${orReplace} TAG${ifNotExist} ${name}${allowedValues}${comment};\n",dropTag:"DROP TAG IF EXISTS ${name};\n",alterTag:"ALTER TAG${ifExists} ${name} ${option}${optionValue};\n"}});var Ue=X((Jn,tt)=>{"use strict";var tn=["DROP SCHEMA","DROP TABLE","DROP COLUMN","DROP VIEW","DROP TAG"],nn={JAVA:"java",JAVASCRIPT:"javascript",PYTHON:"python",SCALA:"scala",SQL:"sql"},rn={SNOWSIGHT:"snowSight",CLASSIC_UI:"classicUI"};tt.exports={DROP_STATEMENTS:tn,LANGUAGES:nn,FORMATS:rn}});var st=X((jn,rt)=>{"use strict";var sn=require("lodash"),nt={ON_ERROR:"ABORT_STATEMENT",SIZE_LIMIT:null,PURGE:!0,RETURN_FAILED_ONLY:!1,MATCH_BY_COLUMN_NAME:"none",ENFORCE_LENGTH:!0,TRUNCATECOLUMNS:!1,FORCE:!1},an=n((s={},a={},t=[])=>t.reduce((o,E)=>sn.isEqual(s[E],a[E])?o:!a[E]&&s[E]!==nt[E]?{...o,[E]:nt[E]}:a[E]?{...o,[E]:a[E]}:o,{}),"getDiffCopyOptionsByDefault");rt.exports={getDiffCopyOptionsByDefault:an}});var Tt=X((er,ct)=>{"use strict";var Ye=require("lodash"),{getDiffCopyOptionsByDefault:on}=st(),it=["description","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS"],at=["targetLag","warehouse","DATA_RETENTION_TIME_IN_DAYS","MAX_DATA_EXTENSION_TIME_IN_DAYS","description"],mn=Ye.uniq([...it,...at]),cn=["id"],Tn=n((s,a)=>a.some(t=>(s==null?void 0:s.oldField[t])!==(s==null?void 0:s.newField[t])),"checkFieldPropertiesChanged"),En=n(s=>({udfs:s.UDFs,sequences:s.sequences,fileFormats:s.fileFormats}),"prepareContainerLevelData"),un=n((s,a,t)=>{let{schemaName:o,databaseName:E}=ot(s,a),l=a(s.isCaseSensitive,t(s));return{schemaName:o,databaseName:E,tableName:l}},"getNames"),ot=n((s,a)=>{var u;let{database:t,isCaseSensitive:o}=((u=s.compMod)==null?void 0:u.bucketProperties)||{},{keyspaceName:E}=s.compMod,l=a(o,E),C=a(o,t);return{schemaName:l,databaseName:C}},"getBaseAndContainerNames"),ln=n(({collection:s,data:a})=>{let{database:t}=(s==null?void 0:s.role)||{};return a={...a,nameData:{...a.nameData||{},database:t}},{collection:s,data:a}},"prepareContainerName"),An=n(({collection:s,data:a})=>{var o,E,l;let t=((o=s==null?void 0:s.role)==null?void 0:o.compMod)||{};return a={...a,nameData:{...a.nameData||{},isExternal:(E=s==null?void 0:s.role)==null?void 0:E.external,database:(l=t==null?void 0:t.bucketProperties)==null?void 0:l.database,schemaName:t==null?void 0:t.keyspaceName}},{collection:s,data:a}},"prepareTableName"),pn=n((s={})=>{let a=s.code,t=s.name||s.collectionName;return{oldName:(a==null?void 0:a.old)||(t==null?void 0:t.old),newName:(a==null?void 0:a.new)||(t==null?void 0:t.new)}},"setName"),Nn=n(({collection:s,data:a})=>{let{compMod:t,isCaseSensitive:o,name:E,code:l,materialized:C}=(s==null?void 0:s.role)||{},u=pn(t),G=(u==null?void 0:u.newName)!==(u==null?void 0:u.oldName);return a={...a,nameData:{...a.nameData||{},isCaseSensitive:o,nameIsChanged:G,isMaterialized:C,newName:(u==null?void 0:u.newName)||l||E,oldName:u==null?void 0:u.oldName}},{collection:s,data:a}},"prepareName"),Sn=n(({collection:s,data:a})=>{let{compMod:t}=(s==null?void 0:s.role)||{},o=mn.reduce((E,l)=>{let{new:C,old:u}=(t==null?void 0:t[l])||{};return u!==C?C&&at.includes(l)?{...E,set:{...E.set,[l]:C}}:u&&it.includes(l)?{...E,unset:[...E.unset,l]}:E:E},{set:{},unset:[]});return{collection:s,data:{...a,setProperty:o.set,unsetProperty:o.unset}}},"prepareAlterSetUnsetData"),yn=n(({collection:s,data:a})=>{var E,l;let t=(l=(E=s==null?void 0:s.role)==null?void 0:E.compMod)==null?void 0:l.managedAccess,o=t&&(t==null?void 0:t.new)!==(t==null?void 0:t.old);return{collection:s,data:{...a,managedAccess:{isChange:o,value:!!(t!=null&&t.new)}}}},"prepareMenageContainerData"),dn=n(({collection:s,data:a})=>{let t=(s==null?void 0:s.role)||{},o=t.compMod||{},{new:E,old:l}=o.fileFormat||{},{new:C,old:u}=o.customFileFormatName||{};return{collection:s,data:{...a,formatData:{isChangeCustomFileFormat:(C||u)&&C!==u,isChangeType:(E||l)&&E!==l,fileFormat:E||(t==null?void 0:t.fileFormat),formatName:C}}}},"prepareCollectionFileFormat"),mt=n((s={},a={})=>{let t=Object.keys(s),o=Object.keys(a);return Ye.union(t,o).filter(E=>!cn.includes(E))},"getObjectCommonKeys"),gn=n(({collection:s,data:a})=>{var C,u;let{new:t={},old:o={}}=((u=(C=s==null?void 0:s.role)==null?void 0:C.compMod)==null?void 0:u.formatTypeOptions)||{},l=mt(o,t).some(G=>!Ye.isEqual(t[G],o[G]));return{collection:s,data:{...a,formatTypeOptions:{optionsIsChanged:l,typeOptions:t}}}},"prepareCollectionFormatTypeOptions"),In=n((s,a,t)=>({collection:o,data:E})=>{var p,v;let{new:l={},old:C={}}=((v=(p=o==null?void 0:o.role)==null?void 0:p.compMod)==null?void 0:v.stageCopyOptions)||{},u=mt(C,l),G=u.some(x=>!t.isEqual(l[x],C[x])),F=on(C,l,u);F={...F,sizeLimit:t.has(F,"SIZE_LIMIT")};let U={optionsIsChanged:G,options:s(a(F))};return{collection:o,data:{...E,stageCopyOptions:U}}},"prepareCollectionStageCopyOptions");ct.exports={checkFieldPropertiesChanged:Tn,prepareContainerLevelData:En,getBaseAndContainerNames:ot,getNames:un,prepareTableName:An,prepareContainerName:ln,prepareName:Nn,prepareAlterSetUnsetData:Sn,prepareMenageContainerData:yn,prepareCollectionFileFormat:dn,prepareCollectionFormatTypeOptions:gn,prepareCollectionStageCopyOptions:In}});var le=X((nr,Et)=>{"use strict";var{FORMATS:Rn}=Ue(),Cn=/(\\r|\\n|\\b|\\f|\\t|'|"|\\[0-9]{3}|\0|\\x5C[0-3]?[0-7]{1,2}|\x5C[xX][0-9A-Fa-f]{2}|\x5C[uU][0-9A-Fa-f]{4}|\\)/g,On=n((s,a)=>s===Rn.SNOWSIGHT?`'${a.replace(Cn,"\\$1")}'`:`$$${a}$$`,"escapeString");Et.exports={escapeString:On}});var At=X((sr,lt)=>{"use strict";var ut=n((s="")=>new RegExp("\\$\\{(.*?)}",s),"template"),_n=n(s=>s.match(ut("gi"))||[],"getAllTemplates"),fn=n(s=>(s.match(ut("i"))||[])[1],"parseTemplate"),$n=n((s,a)=>_n(s).reduce((t,o)=>{let E=fn(o);return t.replace(o,()=>a[E]||a[E]===0?a[E]:"")},s),"assignTemplates");lt.exports=$n});var be=X((ar,pt)=>{"use strict";var Mn=require("lodash"),Ln=["//"],Pn=n((s,a,t)=>Mn.has(a,"isActivated")&&!a.isActivated?t?"// "+s:s.includes(`
`)?s.split(`
`).filter(Boolean).map(o=>"// "+o).join(`
`).concat(`
`):s?"// "+s:"":s,"commentIfDeactivated"),Fn=n((s="")=>Ln.some(a=>s.startsWith(a)),"queryIsDeactivated");pt.exports={commentIfDeactivated:Pn,queryIsDeactivated:Fn}});var ie=X((mr,Nt)=>{"use strict";var z=require("lodash"),Kn=At(),{commentIfDeactivated:Ae}=be();Nt.exports=s=>{let{checkAllKeysActivated:a}=s.require("@hackolade/ddl-fe-utils").general,t=n(r=>String(r).replace(/'/g,"''").replace(/\\\\/g,"\\").replace(/\\/g,"\\\\"),"escape"),o=n(r=>z.isUndefined(r)?r:`'${t(r)}'`,"toString"),E=n(r=>z.toLower(r)==="none","isNone"),l=n(r=>z.toLower(r)==="auto","isAuto"),C=n(r=>E(r)?r:o(r),"toStringIfNotNone"),u=n(r=>l(r)?r:o(r),"toStringIfNotAuto"),G=n(r=>isNaN(r)?"":Number(r),"toNumber"),F=n(r=>r===!0?"TRUE":void 0,"toBoolean"),U=n(r=>Object.entries(r).filter(([S,R])=>!z.isEmpty(R)||R!==!1).map(([S,R])=>(Array.isArray(R)&&(R="("+R.filter(M=>!z.isEmpty(M)).join(", ")+")"),`${S}=${R}`)).join(`
`),"toOptions"),p=n((r,S,R)=>{if(S.GUID===r)return[{...S,name:R}];if(z.isPlainObject(S.properties)){let M=Object.keys(S.properties).reduce((K,D)=>{if(K.length)return K;let w=p(r,S.properties[D],D);return w?K.concat(w):K},[]);if(M.length)return[{...S,name:R}].concat(M)}else if(z.isArray(S.items)){let M=S.items.reduce((K,D)=>{if(K.length)return K;let w=p(r,D,"");return w?K.concat(w):K},[]);if(M.length)return[{...S,name:R}].concat(M)}else if(S.items){let M=p(r,S.items,"");if(M)return[{...S,name:R}].concat(M)}},"findJsonSchemaChain"),v=n((r,S,R)=>{let M=z.get(R,"clusteringKey[0].name",""),K=z.get(R,"clusteringKey[0].isActivated",!0),D=n(w=>String(w||"").includes("."),"isComplexName");if(R.expression)return{name:Kn(R.expression,{name:Y(r,M)}),isActivated:K,isExpression:!0};if(M&&!D(M))return{name:M,isActivated:K};{let w=z.get(R,"clusteringKey[0].keyId",""),Z=p(w,S);if(Array.isArray(Z)){let oe=z.get(Z[Z.length-1],"type","").replace(/json/i,"").toLowerCase();return{name:`(${Z.map(Te=>Y(r,Te.name)).filter(Boolean).join(":")}::${oe})`,isActivated:K,isExpression:!0}}}},"composeClusteringKey"),x=n((r,S)=>{if(Array.isArray(S)){let R=", ",M=[],K=S.reduce((D,w)=>{let Z=z.isString(w.name)?w.name.trim():w.trim();return w.isExpression||(Z=Y(r,Z)),z.get(w,"isActivated",!0)?[...D,Z]:(M.push(Z),D)},[]).filter(Boolean);return K.length===0?Ae(M.join(R),{isActivated:!1},!0):M.length===0?K.join(R):K.join(R)+Ae(R+M.join(R),{isActivated:!1},!0)}return S},"foreignKeysToString"),N=n((r,S)=>S==null?void 0:S.map(R=>Y(r,R.name.trim())).join(", "),"foreignActiveKeysToString"),m=n(r=>a(r.foreignKey)&&a(r.primaryKey)&&r.primaryTableActivated&&r.foreignTableActivated,"checkIfForeignKeyActivated"),y=n((r,S)=>{if(!S)return r.map(K=>K.name).join(`,
	`);let R=r.filter(K=>K.isActivated).map(K=>K.name),M=r.filter(K=>!K.isActivated).map(K=>K.name);return R.length===0?Ae(M.join(`,
	`),{isActivated:!1},!0):M.length===0?R.join(`,
	`):R.join(`,
	`)+`
	`+Ae(M.join(`,
	`),{isActivated:!1},!0)},"viewColumnsToString"),Y=n((r,S)=>S&&(r?L(S):d(S)?S:L(S)),"getName"),O=n(r=>r&&(r.code||r.collectionName)||"","getEntityName"),I=n((r,S)=>r?`${r}.${S}`:S,"getFullName"),d=n(r=>/^[a-z_][a-z\d_$]*$/i.test(r),"isValidCaseInsensitiveName"),L=n(r=>/^".*"$/.test(r)?r:`"${r}"`,"addQuotes");return{escape:t,toString:o,isNone:E,isAuto:l,toStringIfNotNone:C,toStringIfNotAuto:u,toNumber:G,toBoolean:F,toOptions:U,composeClusteringKey:v,foreignKeysToString:x,checkIfForeignKeyActivated:m,foreignActiveKeysToString:N,viewColumnsToString:y,getName:Y,getEntityName:O,getFullName:I,getDbName:n(r=>z.get(r,"code")||z.get(r,"name",""),"getDbName"),addQuotes:L,getGroupItemsByCompMode:n(({newItems:r=[],oldItems:S=[]})=>{let R=r.filter(D=>!S.some(w=>w.id===D.id)),M=[],K=[];return S.forEach(D=>{let w=r.find(Z=>Z.id===D.id);w?z.isEqual(w,D)||K.push(w):M.push(D)}),{added:R,removed:M,modified:K}},"getGroupItemsByCompMode")}}});var yt=X((Tr,St)=>{"use strict";var re=require("lodash");St.exports=s=>{let{clean:a}=s.require("@hackolade/ddl-fe-utils").general,{addQuotes:t}=ie()(s),o=n((m,y)=>Object.entries(m.properties).map(y),"mapProperties"),E=n(m=>!(m.compositeUniqueKey||!m.unique),"isUniqueKey"),l=n(m=>!(m.compositeUniqueKey||m.compositePrimaryKey||!m.primaryKey),"isPrimaryKey"),C=n((m,y,Y,O)=>a({keyType:"UNIQUE",name:m.constraintName,columns:[{name:y,isActivated:Y}],include:U(m.include||m.indexInclude||[],O),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydrateUniqueOptions"),u=n((m,y,Y,O)=>a({keyType:"PRIMARY KEY",name:m.constraintName,columns:[{name:y,isActivated:Y}],include:U(m.include||m.indexInclude||[],O),storageParameters:m.indexStorageParameters,comment:m.indexComment,tablespace:m.indexTablespace}),"hydratePrimaryKeyOptions"),G=n((m,y)=>Object.keys(y).find(Y=>y[Y].GUID===m),"findName"),F=n((m,y)=>re.get(Object.values(y).find(Y=>Y.GUID===m),"isActivated",!0),"checkIfActivated"),U=n((m,y)=>re.map(m,Y=>({name:G(Y.keyId,y.properties),isActivated:F(Y.keyId,y.properties)})),"getKeys"),p=n(m=>Array.isArray(m.primaryKey)?m.primaryKey.filter(y=>!re.isEmpty(y.compositePrimaryKey)).map(y=>({...u(y,null,null,m),columns:U(y.compositePrimaryKey,m)})):[],"getCompositePrimaryKeys"),v=n(m=>Array.isArray(m.uniqueKey)?m.uniqueKey.filter(y=>!re.isEmpty(y.compositeUniqueKey)).map(y=>({...C(y,null,null,m),columns:U(y.compositeUniqueKey,m)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:n(({jsonSchema:m})=>{if(!m.properties)return[];let y=o(m,([O,I])=>{if(l(I)){if(re.isEmpty(I.primaryKeyOptions))return}else return;return u(re.first(I.primaryKeyOptions),O,I.isActivated,m)}).filter(Boolean),Y=re.flatten(o(m,([O,I])=>{if(E(I)){if(re.isEmpty(I.uniqueKeyOptions)||!Array.isArray(I.uniqueKeyOptions))return[]}else return[];return I.uniqueKeyOptions.map(d=>C(d,O,I.isActivated,m))})).filter(Boolean);return[...y,...p(m),...Y,...v(m)]},"getTableKeyConstraints"),getClusteringKey:n(({clusteringKey:m,isParentActivated:y})=>{if(!Array.isArray(m)||m.length===0)return"";let Y=n(({name:d})=>t(d),"mapName"),O=m.filter(d=>d.isActivated).map(Y).join(", "),I=m.filter(d=>!d.isActivated).map(Y).join(", ");return y?O.length===0?`// CLUSTER BY (${I})
`:I.length===0?`CLUSTER BY (${O})
`:`CLUSTER BY (${O}) //${I}
`:`CLUSTER BY (${m.map(Y).join(", ")})
`},"getClusteringKey")}}});var gt=X((ur,dt)=>{"use strict";var pe=require("lodash");dt.exports=s=>{let{tab:a}=s.require("@hackolade/ddl-fe-utils").general,{toOptions:t}=ie()(s),o=n((p,v,x="")=>p!=="custom"?`(
`+a(`TYPE=${p}
${t(v)}`)+`
)`:`(
`+a(`FORMAT_NAME='${x}'`)+`
)`,"getFileFormat"),E=n(p=>pe.isEmpty(p)?"":`STAGE_COPY_OPTIONS = (
`+a(t(p))+`
)`,"getCopyOptions"),l=n((p,v)=>{let x=pe.trim(a(p.filter(N=>!!pe.trim(N,`	
 `)).join(`
`)),`	
`);return pe.trim(v)?x+`
	`+v:x},"addOptions"),C=n(p=>p.TIMESTAMP?`${p.atOrBefore} (timestamp => ${p.TIMESTAMP})`:p.OFFSET?`${p.atOrBefore} (offset => ${p.OFFSET})`:p.STATEMENT?`${p.atOrBefore} (statement => '${p.STATEMENT}')`:"","getAtOrBefore"),u=n(p=>p.map(v=>`"${v.name}"`).join(", "),"mergeKeys");function G({targetLagTimeSpan:p,targetLagAmount:v,targetLagDownstream:x}){return!(p&&v)&&!x?"":`TARGET_LAG = ${x?"DOWNSTREAM":`'${v} ${p}'`}
`}n(G,"getTargetLag");function F(p){let v=n((x,N,m)=>N===m.length-1?`	${x}`:`	${x}
`,"mapStatement");return`AS
${p.split(`
`).map(v).join("")}`}return n(F,"getSelectStatement"),{getFileFormat:o,getCopyOptions:E,addOptions:l,getAtOrBefore:C,mergeKeys:u,getDynamicTableProps:n(({tableData:p,transient:v,tagsStatement:x,clusterKeys:N,comment:m,dataRetentionTime:y,copyGrants:Y,columnDefinitions:O})=>{if(!p.dynamicTableProps)return{};let{selectStatement:I}=p,{targetLag:d,warehouse:L,refreshMode:_,initialize:A,maxDataExtensionTime:r,externalVolume:S,catalog:R,baseLocation:M}=p.dynamicTableProps;return{targetLag:G(d),warehouse:L?`WAREHOUSE = ${L}
`:"",selectStatement:I?F(I):"",externalVolume:S?`EXTERNAL_VOLUME = '${S}'
`:"",catalog:R?`CATALOG = '${R}'
`:"",baseLocation:M?`BASE_LOCATION = '${M}'
`:"",column_definitions:O?`	(
		${O}
	)
`:"",refreshMode:_?`REFRESH_MODE = ${_}
`:"",initialize:A?`INITIALIZE = ${A}
`:"",clusterKeys:N,dataRetentionTime:y?`${y.trim()}
`:"",maxDataExtensionTime:r?`MAX_DATA_EXTENSION_TIME_IN_DAYS = ${r}
`:"",copyGrants:Y?`${Y.trim()}
`:"",comment:m?`${m.trim()}
`:"",tagsStatement:x?`${x.trim()}
`:""}},"getDynamicTableProps")}}});var Ct=X((Ar,Rt)=>{"use strict";var Un=require("lodash"),It=n(s=>Array.isArray(s)?s.filter(a=>a&&a.NULL_IF_item):[],"getNullIf"),Yn=n(s=>(a,t)=>{let{toString:o,toStringIfNotNone:E,toStringIfNotAuto:l,toNumber:C,toBoolean:u}=ie()(s);switch(a){case"CSV":return{COMPRESSION:t.COMPRESSION,RECORD_DELIMITER:E(t.RECORD_DELIMITER),FIELD_DELIMITER:E(t.FIELD_DELIMITER),FILE_EXTENSION:E(t.FILE_EXTENSION),SKIP_HEADER:C(t.SKIP_HEADER),DATE_FORMAT:l(t.DATE_FORMAT),TIME_FORMAT:l(t.TIME_FORMAT),TIMESTAMP_FORMAT:l(t.TIMESTAMP_FORMAT),BINARY_FORMAT:t.BINARY_FORMAT,ESCAPE:E(t.ESCAPE),ESCAPE_UNENCLOSED_FIELD:E(t.ESCAPE_UNENCLOSED_FIELD),TRIM_SPACE:u(t.TRIM_SPACE),FIELD_OPTIONALLY_ENCLOSED_BY:E(t.FIELD_OPTIONALLY_ENCLOSED_BY),NULL_IF:Un.isEmpty(It(t.NULL_IF))?[]:It(t.NULL_IF).map(G=>o(G.NULL_IF_item)),ERROR_ON_COLUMN_COUNT_MISMATCH:u(t.ERROR_ON_COLUMN_COUNT_MISMATCH),VALIDATE_UTF8:u(t.VALIDATE_UTF8),EMPTY_FIELD_AS_NULL:u(t.EMPTY_FIELD_AS_NULL),SKIP_BYTE_ORDER_MARK:u(t.SKIP_BYTE_ORDER_MARK),ENCODING:o(t.ENCODING)};case"JSON":return{COMPRESSION:t.COMPRESSION,FILE_EXTENSION:E(t.FILE_EXTENSION),ENABLE_OCTAL:u(t.ENABLE_OCTAL),ALLOW_DUPLICATE:u(t.ALLOW_DUPLICATE),STRIP_OUTER_ARRAY:u(t.STRIP_OUTER_ARRAY),STRIP_NULL_VALUES:u(t.STRIP_NULL_VALUES),IGNORE_UTF8_ERRORS:u(t.IGNORE_UTF8_ERRORS),SKIP_BYTE_ORDER_MARK:u(t.SKIP_BYTE_ORDER_MARK)};case"AVRO":return{COMPRESSION:t.COMPRESSION};case"PARQUET":return{COMPRESSION:t.SNAPPY_COMPRESSION?void 0:t.COMPRESSION,SNAPPY_COMPRESSION:t.SNAPPY_COMPRESSION?u(t.SNAPPY_COMPRESSION):void 0,BINARY_AS_TEXT:u(t.BINARY_AS_TEXT)};case"XML":return{COMPRESSION:t.COMPRESSION,IGNORE_UTF8_ERRORS:u(t.IGNORE_UTF8_ERRORS),PRESERVE_SPACE:u(t.PRESERVE_SPACE),STRIP_OUTER_ELEMENT:u(t.STRIP_OUTER_ELEMENT),DISABLE_SNOWFLAKE_DATA:u(t.DISABLE_SNOWFLAKE_DATA),DISABLE_AUTO_CONVERT:u(t.DISABLE_AUTO_CONVERT),SKIP_BYTE_ORDER_MARK:u(t.SKIP_BYTE_ORDER_MARK)};default:return{}}},"getFormatTypeOptions");Rt.exports=Yn});var _t=X((Nr,Ot)=>{"use strict";Ot.exports=s=>{let{toNumber:a,toBoolean:t}=ie()(s),o=n(l=>l.ON_ERROR==="SKIP_FILE_<num>"?`SKIP_FILE_${l.skipFileNum}`:l.ON_ERROR==="SKIP_FILE_<num>%"?`SKIP_FILE_${l.skipFileNumPct}%`:l.ON_ERROR,"getOnError");return{getStageCopyOptions:n(l=>({ON_ERROR:o(l),SIZE_LIMIT:l.sizeLimit?a(l.SIZE_LIMIT):void 0,PURGE:t(l.PURGE),MATCH_BY_COLUMN_NAME:l.MATCH_BY_COLUMN_NAME,ENFORCE_LENGTH:t(l.ENFORCE_LENGTH),RETURN_FAILED_ONLY:t(l.RETURN_FAILED_ONLY),TRUNCATECOLUMNS:t(l.TRUNCATECOLUMNS),LOAD_UNCERTAIN_FILES:l.LOAD_UNCERTAIN_FILES?t(l.LOAD_UNCERTAIN_FILES):void 0,FORCE:t(l.FORCE)}),"getStageCopyOptions")}}});var Mt=X((yr,$t)=>{"use strict";var bn=Ke(),j=require("lodash"),{escapeString:ft}=le();$t.exports=s=>{let a=s.require("@hackolade/ddl-fe-utils").assignTemplates,t=n((N,m)=>{N=j.toUpper(N);let y=N;return l(N)&&m.timePrecision&&!j.isNaN(m.timePrecision)&&(y=`${N}(${m.timePrecision})`),["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(N)&&m.length&&!j.isNaN(m.length)&&(y=`${N}(${m.length})`),["NUMBER","DECIMAL","NUMERIC"].includes(N)&&!j.isNaN(m.scale)&&!j.isNaN(m.precision)&&(y=`${N}(${Number(m.precision)},${Number(m.scale)})`),y},"decorateType"),o=n(N=>["VARCHAR","STRING","TEXT","CHAR","CHARACTER"].includes(j.toUpper(N)),"isString"),E=n(N=>["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","BYTEINT","TINYINT","SMALLINT","REAL","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION"].includes(j.toUpper(N)),"isNumber"),l=n(N=>["TIME","TIMESTAMP_NTZ","TIMESTAMP_TZ","TIMESTAMP_LTZ","TIMESTAMP","TIMESTAMPNTZ","TIMESTAMPTZ","TIMESTAMPLTZ","DATETIME"].includes(j.toUpper(N)),"isTimestamp"),C=n(N=>N.replace(/^'([\S\s]+)'$/,"$1"),"localEscapeString"),u=n(({type:N,defaultValue:m,scriptFormat:y})=>o(N)?ft(y,C(String(m))):j.toUpper(N)==="BOOLEAN"?j.toUpper(m):m,"getDefault"),G=n((N,m,y)=>{if(!y||!E(N))return"";let Y=` ${m}`;return Y+=!j.isNaN(y.step)&&(y.start||y.start===0)?" START "+y.start:"",Y+=!j.isNaN(y.step)&&y.step?" INCREMENT "+y.step:"",Y},"getAutoIncrement"),F=n((N,m)=>!o(N)||j.isEmpty(m)?"":" COLLATE '"+Object.entries(m).map(([y,Y])=>Y).join("-")+"'","getCollation"),U=n(N=>N.unique&&!N.compositeUniqueKey?" UNIQUE":"","getUnique"),p=n(N=>!N.primaryKey||N.compositePrimaryKey?"":" PRIMARY KEY","getPrimaryKey");return{decorateType:t,getDefault:u,getAutoIncrement:G,getCollation:F,getInlineConstraint:n(N=>p(N)+U(N),"getInlineConstraint"),createExternalColumn:n(N=>({statement:a(bn.externalColumnDefinition,{name:N.name,type:t(N.type,N),expression:N.expression?`(${N.expression})`:`(value:${N.name}::${N.type})`,comment:N.comment?` COMMENT ${ft(N.comment)}`:""}),isActivated:N.isActivated}),"createExternalColumn")}}});var Pt=X((gr,Lt)=>{"use strict";Lt.exports=s=>{let{foreignKeysToString:a,foreignActiveKeysToString:t,getName:o}=ie()(s);return{generateConstraint:n(({name:l,keys:C,keyType:u,isParentActivated:G,isCaseSensitive:F})=>{let U=C.map(x=>({...x,name:`${o(F,x.name)}`})),p=U.some(x=>x.isActivated),v=t(F,U);return p&&G&&(v=a(F,U)),{statement:(l!=="undefined"?`CONSTRAINT ${o(F,l)} `:"")+`${u} (${v})`,isActivated:p}},"generateConstraint")}}});var Kt=X((Rr,Ft)=>{"use strict";var he=require("lodash"),{escapeString:hn}=le();Ft.exports=({getName:s,getFullName:a,templates:t,assignTemplates:o,tab:E})=>{let l=n((O,I,d)=>{let L=s(d,I),_=s(d,O);return a(_,L)},"getSchemaFullName"),C=n(({database:O,isCaseSensitive:I,newName:d}={})=>{let L=l(O,d,I);return o(t.alterSchemaScript,{name:L})},"getAlterSchemaScript"),u=n((O,{dynamic:I,database:d,isCaseSensitive:L,newName:_,schemaName:A}={})=>{let r=l(d,A,L),S=s(L,_),R=a(r,S);return o(O,{dynamic:I?" DYNAMIC":"",name:R})},"getAlterEntityScript"),G=n(({script:O,data:I})=>{let{nameData:d}=I,{database:L,isCaseSensitive:_,oldName:A,nameIsChanged:r,newName:S}=d,R=l(L,A,_),M=l(L,S,_);if(r){let K=o(t.alterSchemaScript,{name:R});O=[...O,K+o(t.alterEntityRename,{name:M})]}return{script:O,data:I}},"getAlterSchemaName"),F={description:"COMMENT",targetLag:"TARGET_LAG",warehouse:"WAREHOUSE",DATA_RETENTION_TIME_IN_DAYS:"DATA_RETENTION_TIME_IN_DAYS",MAX_DATA_EXTENSION_TIME_IN_DAYS:"MAX_DATA_EXTENSION_TIME_IN_DAYS"},U=n(({key:O,propValue:I,data:d},L)=>{if(O==="description"){let _=he.get(d,"options.targetScriptOptions.keyword");return hn(_,I)}else if(O==="targetLag"){let{targetLagAmount:_,targetLagTimeSpan:A,targetLagDownstream:r}=d[L].targetLag??{};return r?"DOWNSTREAM":`'${_} ${A}'`}return I},"getValue");return{getAlterSchemaName:G,getSetCollectionProperty:n(O=>({script:I,data:d})=>{let{setProperty:L,nameData:_}=d;if(_!=null&&_.isExternal)return{script:I,data:d};let A=Object.keys(L).map((r,S)=>{let R=L[r],M=U({key:r,data:d,propValue:R},"setProperty"),K=`${F[r]} = ${M}`;return S?E(K):K});if(!he.isEmpty(A)){let r=O+o(t.setPropertySchema,{property:A.join(`
`)});I=[...I,r]}return{script:I,data:d}},"getSetCollectionProperty"),getUnsetCollectionProperty:n(O=>({script:I,data:d})=>{let{unsetProperty:L,nameData:_}=d;if(_!=null&&_.isExternal)return{script:I,data:d};let A=L.map((r,S)=>(r=F[r],S?`${r}`:`${r}`));if(!he.isEmpty(A)){let r=O+o(t.unsetPropertySchema,{property:A.join(`
`)});I=[...I,r]}return{script:I,data:d}},"getUnsetCollectionProperty"),getSchemaMenageAccess:n(O=>({script:I,data:d})=>{let{managedAccess:L}=d;if(L.isChange){let _=L.value?"ENABLE":"DISABLE";I=[...I,O+o(t.manageAccessSchema,{access:_})]}return{script:I,data:d}},"getSchemaMenageAccess"),getAlterSchemaScript:C,getAlterTableFormat:n((O,I)=>({script:d,data:L})=>{let{formatData:_,formatTypeOptions:A,nameData:r}=L;if(r.isExternal)return{script:d,data:L};let S=_.fileFormat,R=_.formatName,M=A.optionsIsChanged||_.isChangeType?A.typeOptions:{};if(_.isChangeType&&!_.fileFormat&&(S="CSV",M={}),S==="custom"&&!R)return{script:d,data:L};if(_.isChangeType||_.isChangeCustomFileFormat||A.optionsIsChanged){let K="STAGE_FILE_FORMAT = "+I(S,M||{},R);d=[...d,O+o(t.setPropertyTable,{property:K})]}return{script:d,data:L}},"getAlterTableFormat"),getAlterEntityScript:u,getAlterEntityRename:n((O,I)=>({script:d,data:L})=>{let{nameData:_}=L,{database:A,isCaseSensitive:r,oldName:S,nameIsChanged:R,newName:M,schemaName:K}=_,D=l(A,K,r),w=a(D,s(r,S)),Z=a(D,s(r,M));if(R&&!_.isExternal){let oe=o(O,{name:w});d=[...d,oe+o(I,{name:Z})]}return{script:d,data:L}},"getAlterEntityRename"),getAlterTableStageCopyOptions:n((O,I,d)=>({script:L,data:_})=>{let{stageCopyOptions:A,nameData:r}=_;if(A.optionsIsChanged&&!d.isEmpty(A.options)&&!(r!=null&&r.isExternal)){let S=I(A.options);L=[...L,O+o(t.setPropertyTable,{property:S})]}return{data:_,script:L}},"getAlterTableStageCopyOptions"),getAlterObjectTagsScript:n(O=>({script:I,data:d})=>{let L={tagsToSet:t.setPropertySchema,tagsToUnset:t.unsetPropertySchema};return Object.entries(L).reduce((_,[A,r])=>{var M;let S=(M=_.data.tags)==null?void 0:M[A];if(!S)return _;let R=O+o(r,{property:S});return{..._,script:[..._.script,R]}},{script:I,data:d})},"getAlterObjectTagsScript")}}});var ht=X((Or,bt)=>{"use strict";var{differenceBy:vn,some:Ut,partition:Yt,isEmpty:ce}=require("lodash");bt.exports=({getName:s,toString:a})=>{let t=n(({tags:F,isCaseSensitive:U,indent:p=" "})=>{if(ce(F))return"";let v=E({tags:F,isCaseSensitive:U});return`${p}WITH TAG ( ${v} )`},"getTagStatement"),o=n(({allowedValues:F})=>ce(F)?"":` ALLOWED_VALUES ${F.map(({value:p})=>a(p)).join(", ")}`,"getTagAllowedValues"),E=n(({tags:F,isCaseSensitive:U})=>F.filter(p=>p.tagName).map(p=>`${l({tagName:p.tagName,isCaseSensitive:U})} = ${a(p.tagValue)}`).join(", "),"getTagKeyValues"),l=n(({tagName:F,isCaseSensitive:U})=>F.split(".").map(p=>s(U||/\s/.test(p),p)).join("."),"getTagName"),C=n(({tags:F=[],oldTags:U=[],isCaseSensitive:p=!1})=>{let[v,x]=Yt(F,({tagName:y})=>!Ut(U,{tagName:y})),N=vn(x,U,({tagName:y,tagValue:Y})=>y&&Y);return ce(v)&&ce(N)?"":`TAG ${E({tags:[...v,...N],isCaseSensitive:p})}`},"getSetTagValue"),u=n(({tags:F=[],oldTags:U=[],isCaseSensitive:p=!1})=>{let[v]=Yt(U,({tagName:N})=>!Ut(F,{tagName:N}));return ce(v)?"":`TAG ${v.map(({tagName:N})=>N).join(", ")}`},"getUnsetTagValue");return{getTagStatement:t,getTagAllowedValues:o,getTagKeyValues:E,prepareObjectTagsData:n(F=>({collection:U,data:p})=>{var O,I,d;let v=(O=U==null?void 0:U.role)==null?void 0:O.isCaseSensitive,x=((d=(I=U==null?void 0:U.role)==null?void 0:I.compMod)==null?void 0:d[F])??{},{new:N,old:m}=x,y=C({tags:N,oldTags:m,isCaseSensitive:v}),Y=u({tags:N,oldTags:m,isCaseSensitive:v});return{collection:U,data:{...p,tags:{tagsToSet:y,tagsToUnset:Y}}}},"prepareObjectTagsData"),getSetTagValue:C,getUnsetTagValue:u}}});var P=require("lodash"),Bn=Je(),vt=ke(),q=Ke(),{LANGUAGES:Bt,FORMATS:xn}=Ue(),{prepareAlterSetUnsetData:ve,prepareContainerName:qn,prepareMenageContainerData:Vn,prepareName:Be,prepareTableName:xt,prepareCollectionFileFormat:Gn,prepareCollectionFormatTypeOptions:wn,prepareCollectionStageCopyOptions:Dn}=Tt(),{escapeString:ae}=le(),Hn=1,Xn=1;module.exports=(s,a,t)=>{var De;let o=t.require("@hackolade/ddl-fe-utils").assignTemplates,{tab:E,hasType:l,clean:C}=t.require("@hackolade/ddl-fe-utils").general,u=((De=a==null?void 0:a.targetScriptOptions)==null?void 0:De.keyword)||xn.SNOWSIGHT,G=yt()(t),{getFileFormat:F,getCopyOptions:U,addOptions:p,getAtOrBefore:v,mergeKeys:x,getDynamicTableProps:N}=gt()(t),m=Ct()(t),{getStageCopyOptions:y}=_t()(t),{toString:Y,toBoolean:O,composeClusteringKey:I,foreignKeysToString:d,checkIfForeignKeyActivated:L,foreignActiveKeysToString:_,getName:A,getFullName:r,getDbName:S,viewColumnsToString:R}=ie()(t),{decorateType:M,getDefault:K,getAutoIncrement:D,getCollation:w,getInlineConstraint:Z,createExternalColumn:oe}=Mt()(t),{generateConstraint:Te}=Pt()(t),{commentIfDeactivated:Ne}=be(),{getAlterSchemaName:qt,getSetCollectionProperty:Se,getUnsetCollectionProperty:ye,getSchemaMenageAccess:Vt,getAlterSchemaScript:Gt,getAlterEntityRename:xe,getAlterTableFormat:wt,getAlterTableStageCopyOptions:Dt,getAlterEntityScript:qe,getAlterObjectTagsScript:de}=Kt()({getName:A,getFullName:r,templates:q,assignTemplates:o,tab:E}),{getTagStatement:ge,getTagAllowedValues:Ie,getTagKeyValues:Ht,prepareObjectTagsData:Re}=ht()({getName:A,toString:Y}),Ve=n((e,i=[],g=[],h=[])=>{let T=[...i,...g,...h].map(B=>e?Ne(B.statement,B):B.statement);return P.isEmpty(T)?"":`,
		`+T.join(`,
		`)},"getOutOfLineConstraints");function Xt(e){return e=e.replace(/^(\$\$|')/,i=>i+`
`),e=e.replace(/(\$\$|')$/,i=>`
	`+i),e}n(Xt,"insertNewlinesAtEdges");let Ce=n(e=>e?" OR REPLACE":"","getOrReplaceStatement"),Ge=n(e=>e?`
	${Xt(ae(u,e))}`:"","getBodyStatement"),Oe=n(e=>e?`
	COMMENT = '${e}'`:"","getCommentsStatement"),we=n(e=>e?`
	NOT NULL`:"","getNotNullStatement"),Wt=n(e=>e?" IF NOT EXISTS":"","getIfNotExistStatement");return{createSchema({schemaName:e,databaseName:i,transient:g,managedAccess:h,dataRetention:T,comment:B,udfs:H,procedures:c,sequences:W,fileFormats:k,stages:Q,isCaseSensitive:V,tags:se,schemaTags:ne}){let te=g?" TRANSIENT":"",$=!isNaN(T)&&T?`
	DATA_RETENTION_TIME_IN_DAYS=${T}`:"",f=h?`
	WITH MANAGED ACCESS`:"",J=B?`
	COMMENT=${ae(u,B)}`:"",ee=A(V,e),_e=A(V,i),He=r(_e,ee),zt=o(q.createSchema,{name:He,transient:te,managed_access:f,data_retention:$,comment:J}),Xe=n(b=>{if(!b)return;let{language:$e,runtimeVersion:Ee,handler:ue,packages:me}=b;if([Bt.SQL,Bt.JAVASCRIPT].includes($e))return;let Me=Ee?`
	RUNTIME_VERSION = '${Ee}'`:"",Le=ue?`
	HANDLER = '${ue}'`:"",Pe=me?`
	PACKAGES = (${n(()=>me.map(({packageName:Fe})=>`'${Fe}'`).join(", "),"joinPackages")()})`:"";return`${Me}${Le}${Pe}`},"getParameters"),Zt=H.map(b=>o(q.createUDF,{name:r(ee,A(V,b.name)),arguments:(b.arguments||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:b.returnType,language:b.language,body:Ge(b.function),comment:Oe(b.comment),orReplace:Ce(b.orReplace),parameters:Xe(b),notNull:we(b.notNull)})),Qt=c.map(({name:b,orReplace:$e,args:Ee,returnType:ue,language:me,runtimeVersion:ze,packages:Me,handler:Le,body:Ze,description:Pe,notNull:Fe})=>o(q.createProcedure,{orReplace:Ce($e),name:r(ee,A(V,b)),arguments:(Ee||"").replace(/^\(([\s\S]+)\)$/,"$1"),returnType:ue,language:me,parameters:Xe({language:me,runtimeVersion:ze,handler:Le,packages:Me}),comment:Oe(Pe),body:Ge(Ze),notNull:we(Fe)})),Jt=W.map(b=>o(q.createSequence,{name:r(ee,A(V,b.name)),start:b.start,increment:b.increment,comment:b.comment})),jt=k.map(b=>o(q.createFileFormat,{name:r(ee,A(V,b.name)),options:F(b.type,b.formatTypeOptions).slice(1,-1),comment:b.comment})),kt=Q.map(b=>o(q.createStage,{name:r(ee,A(V,b.name)),temporary:b.temporary?" TEMPORARY":"",url:b.url?`
	URL=${b.url}`:"",storageIntegration:b.storageIntegration?`
	STORAGE_INTEGRATION=${b.storageIntegration}`:"",credentials:b.credentials?`
	CREDENTIALS=(${b.credentials})`:"",encryption:b.encryption?`
	ENCRYPTION=(${b.encryption})`:""})),We=se.map(b=>this.createTag({tag:b,schemaName:ee,isCaseSensitive:V}));if(!P.isEmpty(ne)){let b=o(q.alterSchema,{name:He,operation:"SET TAG",options:Ht({tags:ne,isCaseSensitive:V})});We.push(b)}let fe=[];return i&&fe.push(o(q.createDatabase,{name:A(V,i)})),fe.push(zt),[...fe,...Zt,...Qt,...Jt,...jt,...kt,...We].join(`
`)},hydrateJsonSchemaColumn(e,i){return e.type==="variant"?P.omit(e,["subtype","mode"]):e},createTable(e,i){let g=P.get(e,"schemaData.schemaName"),h=e.temporary?" TEMPORARY":"",T=e.transient&&!e.temporary?" TRANSIENT":"",B=P.isEmpty(e.clusteringKey)?"":" CLUSTER BY ("+(i?d(e.isCaseSensitive,e.clusteringKey):_(e.isCaseSensitive,e.clusteringKey))+")",H=P.isEmpty(e.partitioningKey)?"":" PARTITION BY ("+(i?d(e.isCaseSensitive,e.partitioningKey.map(f=>({name:`${A(e.isCaseSensitive,f.name)}`,isActivated:f.isActivated}))):x(e.partitioningKey))+")",c=e.comment?` COMMENT=${ae(u,e.comment)}`:"",W=e.copyGrants?" COPY GRANTS":"",k=e.dataRetentionTime?` DATA_RETENTION_TIME_IN_DAYS=${e.dataRetentionTime}`:"",Q=e.fileFormat?E("STAGE_FILE_FORMAT = "+F(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",V=e.fileFormat?E("FILE_FORMAT = "+F(e.fileFormat,e.formatTypeOptions,e.formatName)," "):"",se=E(U(e.copyOptions)," "),ne=E(v(e.cloneParams)," "),te=e.columns.map(f=>Ne(f.statement,f)).join(`,
		`),$=ge({tags:e.tableTags,isCaseSensitive:e.isCaseSensitive});if(e.dynamic){let f=N({tableData:e,tagsStatement:$,clusterKeys:B,comment:c,dataRetentionTime:k,copyGrants:W,columnDefinitions:te}),J=e.dynamicTableProps.iceberg?q.createDynamicIcebergTable:q.createDynamicTable;return o(J,{name:e.fullName,transient:T,...f})}else{if(e.selectStatement)return o(q.createAsSelect,{name:e.fullName,selectStatement:e.selectStatement,tableOptions:p([B,W,$])});if(e.cloneTableName)return o(q.createCloneTable,{name:e.fullName,source_table:r(g,e.cloneTableName),tableOptions:p([ne,W,$])});if(e.likeTableName)return o(q.createLikeTable,{name:e.fullName,source_table:r(g,e.likeTableName),tableOptions:p([B,W,$])});if(e.external){let f=e.externalOptions.location?" WITH LOCATION="+e.externalOptions.location:"",J=e.externalOptions.REFRESH_ON_CREATE?" REFRESH_ON_CREATE="+e.externalOptions.REFRESH_ON_CREATE:"",ee=e.externalOptions.AUTO_REFRESH?" AUTO_REFRESH="+e.externalOptions.AUTO_REFRESH:"",_e=e.externalOptions.PATTERN?" PATTERN="+e.externalOptions.PATTERN:"";return o(q.createExternalTable,{name:e.fullName,tableOptions:p([H,V,f,J,ee,_e,W,$],c),column_definitions:te,out_of_line_constraints:Ve(i,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})}}return o(q.createTable,{name:e.fullName,temporary:h,transient:T,tableOptions:p([B,Q,se,k,W,$],c),column_definitions:te,out_of_line_constraints:Ve(i,e.foreignKeyConstraints,e.compositePrimaryKeys,e.compositeUniqueKeys)})},convertColumnDefinition(e){return{statement:o(q.columnDefinition,{name:e.name,type:M(e.type,e),collation:w(e.type,e.collation),default:P.isUndefined(e.default)?"":" DEFAULT "+K({scriptFormat:u,type:e.type,defaultValue:e.default}),autoincrement:D(e.type,"AUTOINCREMENT",e.autoincrement),identity:D(e.type,"IDENTITY",e.identity),not_nul:e.nullable?"":" NOT NULL",inline_constraint:Z(e),comment:e.comment?` COMMENT ${ae(u,e.comment)}`:"",tag:ge({tags:e.columnTags,isCaseSensitive:e.isCaseSensitive})}),isActivated:e.isActivated}},createForeignKeyConstraint(e,i,g){let h=L(e),T=h?d(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=h?d(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:o(q.createTableForeignKey,{constraint:e.name?`CONSTRAINT ${A(g.isCaseSensitive,e.name)} `:"",columns:T,primary_table:r(A(g.isCaseSensitive,e.primarySchemaName||g.schemaName),A(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:h}},createForeignKey(e,i,g){let h=L(e),T=h?d(e.foreignTableIsCaseSensitive,e.foreignKey):_(e.foreignTableIsCaseSensitive,e.foreignKey),B=h?d(e.primaryTableIsCaseSensitive,e.primaryKey):_(e.primaryTableIsCaseSensitive,e.primaryKey);return{statement:o(q.alterTableForeignKey,{constraint:e.name?`CONSTRAINT ${A(g.isCaseSensitive,e.name)} `:"",table_name:r(e.foreignSchemaName,A(e.foreignTableIsCaseSensitive,e.foreignTable)),columns:T,primary_table:r(e.primarySchemaName,A(e.primaryTableIsCaseSensitive,e.primaryTable)),primary_columns:B}),isActivated:h}},createView(e,i,g){let h=P.get(e,"schemaData.schemaName"),{columnList:T,tableColumns:B,tables:H}=e.keys.reduce((Q,V)=>(Q.columnList.push({name:`${A(e.isCaseSensitive,V.alias||V.name)}`,isActivated:V.isActivated}),Q.tableColumns.push({name:`${A(e.isCaseSensitive,V.entityName)}.${A(e.isCaseSensitive,V.name)}`,isActivated:V.isActivated}),V.entityName&&!Q.tables.includes(V.entityName)&&Q.tables.push(r(V.dbName,V.entityName)),Q),{columnList:[],tableColumns:[],tables:[]});if(P.isEmpty(H)&&!e.selectStatement)return"";let c=e.selectStatement||`SELECT 
	${R(B,g)}
FROM ${H.join(" INNER JOIN ")}`,W=ge({tags:e.viewTags,isCaseSensitive:e.isCaseSensitive,indent:""}),k=e.materialized?G.getClusteringKey({clusteringKey:e.clusteringKey,isParentActivated:g}):void 0;return o(q.createView,{secure:e.secure?" SECURE":"",materialized:e.materialized?" MATERIALIZED":"",name:r(h,e.name),column_list:R(T,g),copy_grants:e.copyGrants?`COPY GRANTS
`:"",comment:e.comment?`COMMENT=${ae(u,e.comment)}
`:"",select_statement:c,tag:W?W+`
`:"",clustering:k})},getDefaultType(e){return Bn[e]},getTypesDescriptors(){return vt},hasType(e){return l(vt,e)},hydrateColumn({columnDefinition:e,jsonSchema:i,dbData:g}){return{...e,name:A(i.isCaseSensitive,e.name),isCaseSensitive:i.isCaseSensitive,timePrecision:Number(i.tPrecision),autoincrement:i.defaultOption==="Autoincrement"&&i.autoincrement?{start:P.get(i,"autoincrement.start_num"),step:P.get(i,"autoincrement.step_num")}:!1,identity:i.defaultOption==="Identity"&&i.identity?{start:P.get(i,"identity.start_num"),step:P.get(i,"identity.step_num")}:!1,collation:i.collate?C({locale:i.locale,caseSensitivity:i.caseSensitivity,accentSensitivity:i.accentSensitivity,punctuationSensitivity:i.punctuationSensitivity,firstLetterPreference:i.firstLetterPreference,caseConversion:i.caseConversion,spaceTrimming:i.spaceTrimming}):{},comment:i.refDescription||i.description,unique:i.uniqueKeyConstraintName?!1:i.unique,primaryKeyConstraintName:i.primaryKeyConstraintName,compositePrimaryKey:i.compositePrimaryKey||i.primaryKeyConstraintName&&i.primaryKey,compositeUniqueKey:i.compositeUniqueKey||i.uniqueKeyConstraintName&&i.unique,uniqueKeyConstraintName:i.uniqueKeyConstraintName,primaryKey:i.primaryKeyConstraintName?!1:e.primaryKey,expression:i.expression,columnTags:i.columnTags??[]}},hydrateSchema(e,{udfs:i,procedures:g,sequences:h,fileFormats:T,stages:B,tags:H}={}){return{schemaName:A(e.isCaseSensitive,e.name),isCaseSensitive:e.isCaseSensitive,databaseName:e.database,comment:e.description,transient:e.transient,managedAccess:e.managedAccess,dataRetention:e.DATA_RETENTION_TIME_IN_DAYS,schemaTags:e.schemaTags,udfs:Array.isArray(i)?i.map(c=>C({name:c.name||void 0,orReplace:c.functionOrReplace||void 0,language:c.functionLanguage||c.storedProcLanguage||void 0,runtimeVersion:c.functionRuntimeVersion||void 0,packages:c.functionPackages||void 0,arguments:c.functionArguments||c.storedProcArgument||void 0,returnType:c.functionReturnType||c.storedProcDataType||void 0,notNull:c.functionNotNull||void 0,handler:c.functionHandler||void 0,function:c.functionBody||c.storedProcFunction?E(P.trim(c.functionBody||c.storedProcFunction)):void 0,comment:c.functionDescription||c.storedProcDescription?`${c.functionDescription||c.storedProcDescription}`:""})).filter(c=>c.name&&c.language&&c.returnType&&c.function):[],procedures:Array.isArray(g)?g.map(c=>C({name:c.name||void 0,orReplace:c.orReplace||void 0,args:c.inputArgs||void 0,returnType:c.returnType||void 0,notNull:c.notNull||void 0,language:c.language||void 0,runtimeVersion:c.runtimeVersion||void 0,packages:c.packages||void 0,handler:c.handler||void 0,body:c.body?E(P.trim(c.body)):void 0,description:c.description||void 0})).filter(c=>c.name):[],sequences:Array.isArray(h)?h.map(c=>C({name:c.name||void 0,start:c.sequenceStart||Hn,increment:c.sequenceIncrement||Xn,comment:c.sequenceComments?` COMMENT=${ae(u,c.sequenceComments)}`:""})).filter(c=>c.name):[],fileFormats:Array.isArray(T)?T.map(c=>C({name:c.name||void 0,type:c.fileFormat,formatTypeOptions:C(m(c.fileFormat,c.formatTypeOptions)),comment:c.fileFormatComments?` COMMENT=${ae(u,c.fileFormatComments)}`:""})).filter(c=>c.name):[],stages:Array.isArray(B)?B.map(c=>C({name:c.name||void 0,temporary:c.temporary,url:c.url,storageIntegration:c.storageIntegration,credentials:c.credentials,encryption:c.encryption})).filter(c=>c.name):[],tags:Array.isArray(H)?H.map(c=>C({name:c.name||void 0,orReplace:c.orReplace||void 0,ifNotExist:c.ifNotExist||void 0,allowedValues:c.allowedValues||void 0,description:c.description||void 0})).filter(c=>c.name):[]}},hydrateTable({tableData:e,entityData:i,jsonSchema:g}){let h=G.getTableKeyConstraints({jsonSchema:g}),T=P.get(i,"[0]",{}),B=A(T.isCaseSensitive,P.get(e,"schemaData.schemaName")),H=A(T.isCaseSensitive,P.get(e,"schemaData.databaseName")),c=A(T.isCaseSensitive,e.name),W=r(H,r(B,c)),k=n($=>$.namespace?$.namespace+$.path:$.path,"getLocation"),Q=T.external?T.externalFileFormat:T.fileFormat,V=h.filter(({keyType:$})=>$==="PRIMARY KEY").reduce(($,f)=>({...$,[f.name]:f.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),se=h.filter(({keyType:$})=>$==="UNIQUE").reduce(($,f)=>({...$,[f.name]:f.columns.map(J=>({name:J.name,isActivated:J.isActivated}))}),{}),ne=e.columnDefinitions.filter($=>$.compositePrimaryKey).reduce(($,f)=>f.primaryKeyConstraintName?{...$,[f.primaryKeyConstraintName]:Array.isArray($[f.primaryKeyConstraintName])?P.uniqBy([...$[f.primaryKeyConstraintName],{name:f.name,isActivated:f.isActivated}],"name"):[{name:f.name,isActivated:f.isActivated}]}:$,V),te=e.columnDefinitions.filter($=>$.compositeUniqueKey).reduce(($,f)=>f.uniqueKeyConstraintName?{...$,[f.uniqueKeyConstraintName]:Array.isArray($[f.uniqueKeyConstraintName])?P.uniqBy([...$[f.uniqueKeyConstraintName],{name:f.name,isActivated:f.isActivated}],"name"):[{name:f.name,isActivated:f.isActivated}]}:$,se);return{...e,fullName:W,name:A(T.isCaseSensitive,e.name),temporary:T.temporary,transient:T.transient,external:T.external,dynamic:T.dynamic,dynamicTableProps:{iceberg:T.iceberg,warehouse:T.warehouse,targetLag:T.targetLag,refreshMode:T.refreshMode,initialize:T.initialize,query:T.query,externalVolume:T.externalVolume,catalog:T.catalog,baseLocation:T.baseLocation,maxDataExtensionTime:isNaN(T.MAX_DATA_EXTENSION_TIME_IN_DAYS)?"":T.MAX_DATA_EXTENSION_TIME_IN_DAYS},selectStatement:T.selectStatement,isCaseSensitive:T.isCaseSensitive,clusteringKey:Array.isArray(T.clusteringKey)?T.clusteringKey.map($=>I(T.isCaseSensitive,g,$)).filter(Boolean):[],partitioningKey:T.partitioningKey,comment:T.description,copyGrants:T.copyGrants,dataRetentionTime:isNaN(T.DATA_RETENTION_TIME_IN_DAYS)?"":T.DATA_RETENTION_TIME_IN_DAYS,fileFormat:Q,formatName:T.customFileFormatName,formatTypeOptions:P.isEmpty(T.formatTypeOptions)?{}:C(m(Q,T.formatTypeOptions)),copyOptions:P.isEmpty(T.stageCopyOptions)?{}:C(y(T.stageCopyOptions)),cloneTableName:A(T.isCaseSensitive,P.get(e,`relatedSchemas[${T.clone}].code`,"")),likeTableName:A(T.isCaseSensitive,P.get(e,`relatedSchemas[${T.like}].code`,"")),cloneParams:P.isEmpty(T.cloneParams)?{}:{atOrBefore:P.toUpper(T.cloneParams.atOrBefore),TIMESTAMP:T.cloneParams.TIMESTAMP,OFFSET:T.cloneParams.OFFSET,STATEMENT:T.cloneParams.STATEMENT},externalOptions:{location:P.isPlainObject(T.location)?k(T.location):"",REFRESH_ON_CREATE:O(T.REFRESH_ON_CREATE),AUTO_REFRESH:O(T.AUTO_REFRESH),PATTERN:T.PATTERN?Y(T.PATTERN):""},columns:T.external?e.columnDefinitions.map(oe):e.columns,compositePrimaryKeys:Object.entries(ne).map(([$,f])=>Te({name:$,keys:f,keyType:"PRIMARY KEY",isActivated:g.isActivated,isCaseSensitive:T.isCaseSensitive})),compositeUniqueKeys:Object.entries(te).map(([$,f])=>Te({name:$,keys:f,keyType:"UNIQUE",isActivated:g.isActivated,isCaseSensitive:T.isCaseSensitive})),tableTags:T.tableTags??[]}},hydrateView({viewData:e,entityData:i}){let g=i[0],{databaseName:h,schemaName:T}=e.schemaData,B=A(g.isCaseSensitive,e.name),H=r(h,r(T,B));return{...e,name:A(g.isCaseSensitive,e.name),selectStatement:g.selectStatement,isCaseSensitive:g.isCaseSensitive,copyGrants:g.copyGrants,comment:g.description,secure:g.secure,materialized:g.materialized,fullName:H,clusteringKey:g.clusteringKey,viewTags:g.viewTags??[]}},hydrateViewColumn(e){var i,g,h;return e.entityName?{...e,name:A((i=e.definition)==null?void 0:i.isCaseSensitive,e.name),dbName:A((g=P.first(e.containerData))==null?void 0:g.isCaseSensitive,e.dbName),entityName:A((h=P.first(e.entityData))==null?void 0:h.isCaseSensitive,e.entityName)}:e},commentIfDeactivated(e,i,g){return Ne(e,i,g)},alterTable(e){if(e.iceberg)return"// Dynamic Iceberg tables are currently only supported for CREATE statements. Specifying DYNAMIC ICEBERG in any other command (for example, ALTER DYNAMIC ICEBERG TABLE <name>) results in an error.";let i=qe(q.alterTableScript,{dynamic:e.dynamic,...e.nameData}),{script:g}=P.flow(xe(q.alterTableScript,q.alterEntityRename),Se(i),ye(i),wt(i,F),Dt(i,U,P),de(i))({data:e,script:[]});return g.join(`
`)},hydrateAlertTable(e){var h,T,B,H;let{data:i}=P.flow(Be,xt,Gn,wn,ve,Dn(C,y,P),Re("tableTags"))({collection:e,data:{}}),g=C(m(i.formatData.fileFormat,i.formatTypeOptions.typeOptions));return{...i,dynamic:e.role.dynamic,iceberg:((T=(h=e.compMod)==null?void 0:h.iceberg)==null?void 0:T.old)||((H=(B=e.compMod)==null?void 0:B.iceberg)==null?void 0:H.new),formatTypeOptions:{...i.formatTypeOptions,typeOptions:g}}},alterView(e){let{nameData:i}=e,g=i.isMaterialized?"alterMaterializedViewScript":"alterViewScript",h=qe(q[g],i),{script:T}=P.flow(xe(q[g],q.alterEntityRename),Se(h),ye(h),de(h))({data:e,script:[]});return T.join(`
`)},hydrateAlterView(e){let{data:i}=P.flow(Be,xt,ve,Re("viewTags"))({collection:e,data:{}});return i},alterSchema(e){let i=Gt(e==null?void 0:e.nameData),{script:g}=P.flow(qt,Se(i),ye(i),Vt(i),de(i))({data:e,script:[]});return g.join(`
`)},hydrateAlterSchema(e){return P.flow(Be,qn,ve,Vn,Re("schemaTags"))({collection:e,data:{}}).data},hydrateForDeleteSchema(e){let i=A(e.isCaseSensitive,S(e)),g=A(e.isCaseSensitive,e.database);return{name:r(g,i)}},dropSchema({name:e}){return o(q.dropSchema,{name:e})},createTag({tag:e,schemaName:i,isCaseSensitive:g}){return o(q.createTag,{orReplace:Ce(e.orReplace),ifNotExist:Wt(e.ifNotExist),allowedValues:Ie({allowedValues:e.allowedValues}),name:r(i,A(g,e.name)),comment:Oe(e.description)})},dropTag({tag:e,schemaName:i,isCaseSensitive:g}){return o(q.dropTag,{name:r(i,A(g,e.name))})},alterTag({tag:e,oldTag:i,schemaName:g,isCaseSensitive:h}){let T=r(g,A(h,i.name)),B=r(g,A(h,e.name)),H=P.flatMap(e.allowedValues,({value:f})=>f).filter(Boolean),c=P.flatMap(i.allowedValues,({value:f})=>f).filter(Boolean),W=P.differenceBy(e.allowedValues,i.allowedValues,({value:f})=>f),k=P.differenceBy(i.allowedValues,e.allowedValues,({value:f})=>f),Q=T!==B,V=i.description&&!e.description,se=!V&&e.description!==i.description,ne=c.length&&!H.length,te=[],$=n((f,J)=>{if(f){let ee=o(q.alterTag,J);te.push(ee)}},"createAndPushStatement");return $(Q,{ifExists:" IF EXISTS",name:T,option:"RENAME TO ",optionValue:A(h,e.name)}),$(ne,{name:B,option:"UNSET ALLOWED_VALUES"}),$(!ne&&!P.isEmpty(k),{ifExists:" IF EXISTS",name:B,option:"DROP",optionValue:Ie({allowedValues:k})}),$(!P.isEmpty(W),{ifExists:" IF EXISTS",name:B,option:"ADD",optionValue:Ie({allowedValues:W})}),$(V,{ifExists:" IF EXISTS",name:B,option:"UNSET COMMENT"}),$(se,{ifExists:" IF EXISTS",name:B,option:"SET COMMENT = ",optionValue:Y(e.description)}),te.join("")}}};
